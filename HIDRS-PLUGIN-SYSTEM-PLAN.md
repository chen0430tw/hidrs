# HIDRSæ’ä»¶ç³»ç»Ÿè§„åˆ’ï¼šè®¾å¤‡æ‰«æä¸æš—ç½‘åŠŸèƒ½

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£è§„åˆ’HIDRSçš„**æ’ä»¶åŒ–æ¶æ„**ï¼Œé€šè¿‡æ’ä»¶æ–¹å¼æ‰©å±•è®¾å¤‡æ‰«æå’Œæš—ç½‘åŠŸèƒ½ï¼Œä¿æŒæ ¸å¿ƒç³»ç»Ÿçš„åˆæ³•æ€§å’Œç®€æ´æ€§ï¼ŒåŒæ—¶æä¾›é«˜çº§OSINTèƒ½åŠ›ã€‚

**è®¾è®¡ç†å¿µ**ï¼š
- æ ¸å¿ƒç³»ç»Ÿä¿æŒåˆæ³•ã€ç®€æ´ã€å¼€æº
- é«˜çº§åŠŸèƒ½é€šè¿‡æ’ä»¶æŒ‰éœ€åŠ è½½
- æ’ä»¶éœ€è¦ç”¨æˆ·æ˜ç¡®æˆæƒå’Œé…ç½®
- æ¸…æ™°çš„è´£ä»»è¾¹ç•Œå’Œä½¿ç”¨æ¡æ¬¾

---

## ğŸ¯ æ’ä»¶ç³»ç»Ÿæ€»ä½“æ¶æ„

### æ ¸å¿ƒæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              HIDRS Core System                  â”‚
â”‚  â€¢ æ‹‰æ™®æ‹‰æ–¯è°±åˆ†æ                                â”‚
â”‚  â€¢ å…¨æ¯æ˜ å°„                                      â”‚
â”‚  â€¢ å¤šå¹³å°çˆ¬è™«ï¼ˆå…¬å¼€Webï¼‰                          â”‚
â”‚  â€¢ å†³ç­–åé¦ˆ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Plugin Managerï¼ˆæ’ä»¶ç®¡ç†å™¨ï¼‰           â”‚
â”‚  â€¢ æ’ä»¶æ³¨å†Œä¸å‘ç°                                 â”‚
â”‚  â€¢ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåŠ è½½/å¸è½½/æ›´æ–°ï¼‰                  â”‚
â”‚  â€¢ æƒé™ç®¡ç†ä¸æ²™ç®±                                 â”‚
â”‚  â€¢ é…ç½®ç®¡ç†                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Device Scannerâ”‚    â”‚ DarkWeb      â”‚  â”‚Third-party   â”‚
â”‚   Plugin     â”‚    â”‚ Crawler      â”‚  â”‚ API Plugin   â”‚
â”‚              â”‚    â”‚ Plugin       â”‚  â”‚              â”‚
â”‚â€¢ Shodan API  â”‚    â”‚â€¢ Toræ”¯æŒ     â”‚  â”‚â€¢ VirusTotal  â”‚
â”‚â€¢ Censys API  â”‚    â”‚â€¢ I2Pæ”¯æŒ     â”‚  â”‚â€¢ AlienVault  â”‚
â”‚â€¢ ZoomEye     â”‚    â”‚â€¢ Onionçˆ¬è™«   â”‚  â”‚â€¢ AbuseIPDB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’ä»¶ç³»ç»Ÿç›®å½•ç»“æ„

```
hidrs/
â”œâ”€â”€ core/                      # æ ¸å¿ƒç³»ç»Ÿï¼ˆä¸å˜ï¼‰
â”‚   â”œâ”€â”€ crawler.py
â”‚   â”œâ”€â”€ search_engine.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ plugins/                   # æ’ä»¶ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py               # æ’ä»¶åŸºç±»
â”‚   â”œâ”€â”€ manager.py            # æ’ä»¶ç®¡ç†å™¨
â”‚   â”œâ”€â”€ device_scanner/       # è®¾å¤‡æ‰«ææ’ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ plugin.py
â”‚   â”‚   â”œâ”€â”€ shodan_client.py
â”‚   â”‚   â”œâ”€â”€ censys_client.py
â”‚   â”‚   â””â”€â”€ config.yaml
â”‚   â”œâ”€â”€ darkweb_crawler/      # æš—ç½‘çˆ¬è™«æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ plugin.py
â”‚   â”‚   â”œâ”€â”€ tor_crawler.py
â”‚   â”‚   â”œâ”€â”€ i2p_crawler.py
â”‚   â”‚   â””â”€â”€ config.yaml
â”‚   â””â”€â”€ api_integrations/     # ç¬¬ä¸‰æ–¹APIæ’ä»¶
â”‚       â”œâ”€â”€ virustotal.py
â”‚       â”œâ”€â”€ alienvault.py
â”‚       â””â”€â”€ config.yaml
â”œâ”€â”€ plugin_configs/           # ç”¨æˆ·é…ç½®ï¼ˆä¸æäº¤åˆ°Gitï¼‰
â”‚   â”œâ”€â”€ device_scanner.yaml
â”‚   â””â”€â”€ darkweb_crawler.yaml
â””â”€â”€ docs/
    â””â”€â”€ plugin_development.md # æ’ä»¶å¼€å‘æ–‡æ¡£
```

---

## ğŸ”Œ æ’ä»¶1: è®¾å¤‡æ‰«ææ’ä»¶ï¼ˆDevice Scanner Pluginï¼‰

### åŠŸèƒ½æ¦‚è¿°

é›†æˆShodanã€Censysã€ZoomEyeç­‰è®¾å¤‡æœç´¢å¼•æ“APIï¼Œæä¾›äº’è”ç½‘è®¾å¤‡æ‰«æå’Œæ¼æ´æƒ…æŠ¥ã€‚

### æ”¯æŒçš„API

| APIæœåŠ¡ | åŠŸèƒ½ | è´¹ç”¨ | ä¼˜å…ˆçº§ |
|---------|------|------|--------|
| **Shodan** | IoTè®¾å¤‡ã€å¼€æ”¾ç«¯å£ã€æ¼æ´ | å…è´¹/ä»˜è´¹ | â­â­â­ é«˜ |
| **Censys** | è¯ä¹¦ã€IPã€åŸŸåæ‰«æ | å…è´¹/ä»˜è´¹ | â­â­â­ é«˜ |
| **ZoomEye** | è®¾å¤‡æŒ‡çº¹ã€æ¼æ´æƒ…æŠ¥ | å…è´¹/ä»˜è´¹ | â­â­ ä¸­ |
| **FOFA** | ä¸­å›½ç‰ˆShodan | ä»˜è´¹ | â­â­ ä¸­ |
| **BinaryEdge** | å¨èƒæƒ…æŠ¥ã€æ¼æ´æ‰«æ | ä»˜è´¹ | â­ ä½ |

### æŠ€æœ¯å®ç°

#### æ’ä»¶åŸºç±»

```python
# plugins/base.py
from abc import ABC, abstractmethod
from typing import Dict, Any, List

class HIDRSPlugin(ABC):
    """HIDRSæ’ä»¶åŸºç±»"""

    def __init__(self, config: Dict[str, Any]):
        self.config = config
        self.enabled = config.get('enabled', False)
        self.name = self.__class__.__name__

    @abstractmethod
    def initialize(self) -> bool:
        """æ’ä»¶åˆå§‹åŒ–"""
        pass

    @abstractmethod
    def execute(self, query: str, **kwargs) -> List[Dict[str, Any]]:
        """æ‰§è¡ŒæŸ¥è¯¢"""
        pass

    @abstractmethod
    def validate_config(self) -> bool:
        """éªŒè¯é…ç½®"""
        pass

    def get_capabilities(self) -> List[str]:
        """è¿”å›æ’ä»¶èƒ½åŠ›åˆ—è¡¨"""
        return []

    def shutdown(self):
        """æ’ä»¶æ¸…ç†"""
        pass
```

#### è®¾å¤‡æ‰«ææ’ä»¶å®ç°

```python
# plugins/device_scanner/plugin.py
import shodan
import censys.search
from plugins.base import HIDRSPlugin

class DeviceScannerPlugin(HIDRSPlugin):
    """è®¾å¤‡æ‰«ææ’ä»¶"""

    REQUIRED_PERMISSIONS = [
        'network.scan',
        'api.external',
        'data.sensitive'
    ]

    def __init__(self, config):
        super().__init__(config)
        self.shodan_client = None
        self.censys_client = None

    def initialize(self) -> bool:
        """åˆå§‹åŒ–APIå®¢æˆ·ç«¯"""
        if not self.validate_config():
            raise ValueError("Invalid plugin configuration")

        # åˆå§‹åŒ–Shodan
        if self.config.get('shodan', {}).get('api_key'):
            self.shodan_client = shodan.Shodan(
                self.config['shodan']['api_key']
            )
            logger.info("Shodan API initialized")

        # åˆå§‹åŒ–Censys
        if self.config.get('censys', {}).get('api_id'):
            self.censys_client = censys.search.CensysHosts(
                api_id=self.config['censys']['api_id'],
                api_secret=self.config['censys']['api_secret']
            )
            logger.info("Censys API initialized")

        return True

    def execute(self, query: str, **kwargs) -> List[Dict[str, Any]]:
        """æ‰§è¡Œè®¾å¤‡æœç´¢"""
        results = []
        search_type = kwargs.get('search_type', 'shodan')

        if search_type == 'shodan' and self.shodan_client:
            results.extend(self._search_shodan(query, **kwargs))

        if search_type == 'censys' and self.censys_client:
            results.extend(self._search_censys(query, **kwargs))

        # ç»“æœæ ‡å‡†åŒ–
        return self._normalize_results(results)

    def _search_shodan(self, query: str, **kwargs) -> List[Dict]:
        """Shodanæœç´¢"""
        try:
            # ShodanæŸ¥è¯¢
            results = self.shodan_client.search(
                query,
                limit=kwargs.get('limit', 100)
            )

            devices = []
            for result in results['matches']:
                devices.append({
                    'ip': result['ip_str'],
                    'port': result['port'],
                    'org': result.get('org', 'Unknown'),
                    'os': result.get('os', 'Unknown'),
                    'hostnames': result.get('hostnames', []),
                    'location': {
                        'country': result.get('location', {}).get('country_name'),
                        'city': result.get('location', {}).get('city'),
                    },
                    'vulns': result.get('vulns', []),
                    'services': result.get('data', ''),
                    'timestamp': result.get('timestamp'),
                    'source': 'shodan'
                })

            return devices
        except shodan.APIError as e:
            logger.error(f"Shodan API error: {e}")
            return []

    def _search_censys(self, query: str, **kwargs) -> List[Dict]:
        """Censysæœç´¢"""
        try:
            results = []
            for page in self.censys_client.search(query, per_page=100):
                for host in page:
                    results.append({
                        'ip': host['ip'],
                        'services': host.get('services', []),
                        'protocols': host.get('protocols', []),
                        'location': host.get('location', {}),
                        'autonomous_system': host.get('autonomous_system', {}),
                        'source': 'censys'
                    })
            return results
        except Exception as e:
            logger.error(f"Censys API error: {e}")
            return []

    def _normalize_results(self, results: List[Dict]) -> List[Dict]:
        """æ ‡å‡†åŒ–ä¸åŒAPIçš„ç»“æœæ ¼å¼"""
        normalized = []
        for result in results:
            normalized.append({
                'type': 'device',
                'ip': result.get('ip'),
                'port': result.get('port'),
                'organization': result.get('org') or result.get('autonomous_system', {}).get('name'),
                'location': result.get('location'),
                'vulnerabilities': result.get('vulns', []),
                'services': result.get('services', []),
                'metadata': {
                    'source': result.get('source'),
                    'timestamp': result.get('timestamp'),
                    'raw_data': result
                }
            })
        return normalized

    def validate_config(self) -> bool:
        """éªŒè¯é…ç½®"""
        # è‡³å°‘éœ€è¦ä¸€ä¸ªAPIå¯†é’¥
        has_shodan = bool(self.config.get('shodan', {}).get('api_key'))
        has_censys = bool(self.config.get('censys', {}).get('api_id'))
        return has_shodan or has_censys

    def get_capabilities(self) -> List[str]:
        """è¿”å›æ’ä»¶èƒ½åŠ›"""
        capabilities = ['device_search', 'vulnerability_scan']
        if self.shodan_client:
            capabilities.append('shodan')
        if self.censys_client:
            capabilities.append('censys')
        return capabilities
```

#### é…ç½®æ–‡ä»¶

```yaml
# plugins/device_scanner/config.yaml
name: DeviceScannerPlugin
version: 1.0.0
enabled: false  # é»˜è®¤ç¦ç”¨ï¼Œéœ€è¦ç”¨æˆ·ä¸»åŠ¨å¯ç”¨
description: "è®¾å¤‡æ‰«ææ’ä»¶ï¼Œé›†æˆShodanã€Censysç­‰API"

permissions:
  - network.scan
  - api.external
  - data.sensitive

dependencies:
  - shodan>=1.28.0
  - censys>=2.1.0

# ç”¨æˆ·é…ç½®ï¼ˆéœ€è¦åœ¨plugin_configs/ä¸­åˆ›å»ºï¼‰
shodan:
  api_key: ""  # ç”¨æˆ·éœ€è¦å¡«å†™
  rate_limit: 100
  timeout: 30

censys:
  api_id: ""
  api_secret: ""
  rate_limit: 50

zoomeye:
  api_key: ""
  enabled: false

# ä½¿ç”¨é™åˆ¶
usage_limits:
  max_requests_per_hour: 100
  max_results_per_query: 1000

# åˆè§„æ€§
compliance:
  require_user_consent: true
  log_all_queries: true
  data_retention_days: 30
```

#### Flask APIç«¯ç‚¹

```python
# backend/crawler_server.py
@app.route('/api/plugins/device-scanner/search', methods=['POST'])
def device_scanner_search():
    """è®¾å¤‡æ‰«æAPI"""
    # æ£€æŸ¥æ’ä»¶æ˜¯å¦å¯ç”¨
    if not plugin_manager.is_enabled('DeviceScannerPlugin'):
        return jsonify({'error': 'Device scanner plugin not enabled'}), 403

    # æ£€æŸ¥ç”¨æˆ·æƒé™
    if not check_user_permission('network.scan'):
        return jsonify({'error': 'Permission denied'}), 403

    data = request.json
    query = data.get('query')
    search_type = data.get('search_type', 'shodan')
    limit = data.get('limit', 100)

    # è®°å½•æŸ¥è¯¢æ—¥å¿—ï¼ˆåˆè§„æ€§è¦æ±‚ï¼‰
    logger.info(f"Device scan query: {query}, user: {get_current_user()}")

    try:
        plugin = plugin_manager.get_plugin('DeviceScannerPlugin')
        results = plugin.execute(
            query=query,
            search_type=search_type,
            limit=limit
        )

        return jsonify({
            'success': True,
            'query': query,
            'count': len(results),
            'results': results,
            'source': search_type
        })
    except Exception as e:
        logger.error(f"Device scanner error: {e}")
        return jsonify({'error': str(e)}), 500
```

---

## ğŸ•¸ï¸ æ’ä»¶2: æš—ç½‘çˆ¬è™«æ’ä»¶ï¼ˆDarkWeb Crawler Pluginï¼‰

### åŠŸèƒ½æ¦‚è¿°

æ”¯æŒTorã€I2Pç­‰åŒ¿åç½‘ç»œçš„çˆ¬è™«åŠŸèƒ½ï¼Œç”¨äºæš—ç½‘æƒ…æŠ¥æ”¶é›†ï¼ˆéœ€ä¸¥æ ¼åˆè§„å®¡æŸ¥ï¼‰ã€‚

### æ”¯æŒçš„åŒ¿åç½‘ç»œ

| ç½‘ç»œç±»å‹ | åè®® | ç”¨é€” | å®ç°éš¾åº¦ |
|---------|------|------|---------|
| **Tor** | .onion | æš—ç½‘å¸‚åœºã€è®ºå› | ä¸­ |
| **I2P** | .i2p | P2PåŒ¿åç½‘ç»œ | é«˜ |
| **Freenet** | - | å®¡æŸ¥æŠµæŠ— | é«˜ |

### æŠ€æœ¯å®ç°

#### Torçˆ¬è™«å®ç°

```python
# plugins/darkweb_crawler/tor_crawler.py
import requests
from stem import Signal
from stem.control import Controller
import socks
import socket

class TorCrawler:
    """Torç½‘ç»œçˆ¬è™«"""

    def __init__(self, config):
        self.config = config
        self.tor_proxy = config.get('tor_proxy', 'socks5://127.0.0.1:9050')
        self.control_port = config.get('control_port', 9051)
        self.control_password = config.get('control_password', '')

    def initialize(self) -> bool:
        """åˆå§‹åŒ–Torè¿æ¥"""
        # è®¾ç½®SOCKSä»£ç†
        socks.set_default_proxy(
            socks.SOCKS5,
            "127.0.0.1",
            9050
        )
        socket.socket = socks.socksocket

        # æµ‹è¯•Torè¿æ¥
        try:
            response = requests.get(
                'https://check.torproject.org/api/ip',
                timeout=30
            )
            data = response.json()
            if data.get('IsTor'):
                logger.info(f"Tor connection established. IP: {data['IP']}")
                return True
        except Exception as e:
            logger.error(f"Tor connection failed: {e}")
            return False

    def crawl_onion_site(self, onion_url: str) -> Dict[str, Any]:
        """çˆ¬å–.onionç½‘ç«™"""
        try:
            # é…ç½®è¯·æ±‚
            session = requests.Session()
            session.proxies = {
                'http': self.tor_proxy,
                'https': self.tor_proxy
            }

            # å‘èµ·è¯·æ±‚
            response = session.get(
                onion_url,
                timeout=60,
                headers={
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0'
                }
            )

            return {
                'url': onion_url,
                'status_code': response.status_code,
                'content': response.text,
                'headers': dict(response.headers),
                'timestamp': datetime.now().isoformat(),
                'network': 'tor'
            }
        except Exception as e:
            logger.error(f"Failed to crawl {onion_url}: {e}")
            return {
                'url': onion_url,
                'error': str(e),
                'network': 'tor'
            }

    def renew_tor_identity(self):
        """æ›´æ¢Torèº«ä»½ï¼ˆIPåœ°å€ï¼‰"""
        try:
            with Controller.from_port(port=self.control_port) as controller:
                controller.authenticate(password=self.control_password)
                controller.signal(Signal.NEWNYM)
                time.sleep(5)  # ç­‰å¾…æ–°ç”µè·¯å»ºç«‹
                logger.info("Tor identity renewed")
        except Exception as e:
            logger.error(f"Failed to renew Tor identity: {e}")
```

#### æš—ç½‘çˆ¬è™«æ’ä»¶ä¸»ç±»

```python
# plugins/darkweb_crawler/plugin.py
from plugins.base import HIDRSPlugin
from .tor_crawler import TorCrawler

class DarkWebCrawlerPlugin(HIDRSPlugin):
    """æš—ç½‘çˆ¬è™«æ’ä»¶"""

    REQUIRED_PERMISSIONS = [
        'network.anonymous',
        'crawler.darkweb',
        'data.sensitive'
    ]

    # åˆè§„æ€§è­¦å‘Š
    COMPLIANCE_WARNING = """
    âš ï¸ æš—ç½‘çˆ¬è™«æ’ä»¶ä»…ç”¨äºåˆæ³•çš„å®‰å…¨ç ”ç©¶å’Œå¨èƒæƒ…æŠ¥æ”¶é›†ã€‚
    ä½¿ç”¨æœ¬æ’ä»¶å‰ï¼Œè¯·ç¡®ä¿ï¼š
    1. æ‚¨æœ‰åˆæ³•çš„ç ”ç©¶ç›®çš„
    2. éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
    3. ä¸è®¿é—®éæ³•å†…å®¹ï¼ˆå„¿ç«¥è‰²æƒ…ã€æ¯’å“äº¤æ˜“ç­‰ï¼‰
    4. ä¸å‚ä¸éæ³•æ´»åŠ¨

    ä½¿ç”¨æœ¬æ’ä»¶å³è¡¨ç¤ºæ‚¨åŒæ„ä¸Šè¿°æ¡æ¬¾ã€‚
    """

    def __init__(self, config):
        super().__init__(config)
        self.tor_crawler = None
        self.user_consent = config.get('user_consent', False)

    def initialize(self) -> bool:
        """åˆå§‹åŒ–æš—ç½‘çˆ¬è™«"""
        # å¼ºåˆ¶è¦æ±‚ç”¨æˆ·åŒæ„
        if not self.user_consent:
            raise ValueError(
                "DarkWeb Crawler requires explicit user consent. "
                "Set 'user_consent: true' in config after reading the terms."
            )

        # æ˜¾ç¤ºåˆè§„æ€§è­¦å‘Š
        logger.warning(self.COMPLIANCE_WARNING)

        # åˆå§‹åŒ–Torçˆ¬è™«
        if self.config.get('tor', {}).get('enabled'):
            self.tor_crawler = TorCrawler(self.config['tor'])
            if not self.tor_crawler.initialize():
                logger.error("Tor initialization failed")
                return False

        return True

    def execute(self, query: str, **kwargs) -> List[Dict[str, Any]]:
        """æ‰§è¡Œæš—ç½‘çˆ¬å–"""
        network = kwargs.get('network', 'tor')

        # éªŒè¯URLæ ¼å¼
        if network == 'tor' and not query.endswith('.onion'):
            raise ValueError("Invalid Tor URL. Must end with .onion")

        # è®°å½•åˆè§„æ—¥å¿—
        logger.info(f"DarkWeb crawl: {query}, network: {network}, user: {get_current_user()}")

        results = []

        if network == 'tor' and self.tor_crawler:
            result = self.tor_crawler.crawl_onion_site(query)
            results.append(result)

            # å®šæœŸæ›´æ¢èº«ä»½
            if kwargs.get('renew_identity', True):
                self.tor_crawler.renew_tor_identity()

        return results

    def validate_config(self) -> bool:
        """éªŒè¯é…ç½®"""
        # å¿…é¡»æ˜ç¡®å¯ç”¨å¹¶åŒæ„æ¡æ¬¾
        return (
            self.config.get('enabled', False) and
            self.config.get('user_consent', False)
        )

    def get_capabilities(self) -> List[str]:
        """è¿”å›æ’ä»¶èƒ½åŠ›"""
        capabilities = []
        if self.tor_crawler:
            capabilities.append('tor')
        return capabilities
```

#### é…ç½®æ–‡ä»¶

```yaml
# plugins/darkweb_crawler/config.yaml
name: DarkWebCrawlerPlugin
version: 1.0.0
enabled: false  # é»˜è®¤ç¦ç”¨
description: "æš—ç½‘çˆ¬è™«æ’ä»¶ï¼Œæ”¯æŒTorã€I2Pç½‘ç»œ"

permissions:
  - network.anonymous
  - crawler.darkweb
  - data.sensitive

dependencies:
  - stem>=1.8.0
  - PySocks>=1.7.1
  - requests[socks]>=2.28.0

# ç”¨æˆ·å¿…é¡»ä¸»åŠ¨åŒæ„åˆè§„æ¡æ¬¾
user_consent: false  # ç”¨æˆ·éœ€è¦æ”¹ä¸ºtrue

tor:
  enabled: false
  proxy: "socks5://127.0.0.1:9050"
  control_port: 9051
  control_password: ""  # Toræ§åˆ¶å¯†ç 
  renew_identity_interval: 300  # 5åˆ†é’Ÿ

i2p:
  enabled: false
  proxy: "http://127.0.0.1:4444"

# å®‰å…¨é™åˆ¶
security:
  # é»‘åå•ï¼ˆä¸å…è®¸çˆ¬å–çš„å†…å®¹ç±»å‹ï¼‰
  content_blacklist:
    - "child_exploitation"
    - "illegal_drugs"
    - "weapons_trafficking"
    - "human_trafficking"

  # è®¿é—®é€Ÿç‡é™åˆ¶
  rate_limit: 10  # æ¯åˆ†é’Ÿæœ€å¤š10ä¸ªè¯·æ±‚

  # è¶…æ—¶è®¾ç½®
  timeout: 60  # ç§’

  # æœ€å¤§é‡è¯•æ¬¡æ•°
  max_retries: 3

# åˆè§„æ€§
compliance:
  require_user_consent: true
  log_all_requests: true
  data_retention_days: 90
  report_illegal_content: true  # å‘ç°éæ³•å†…å®¹æ—¶æŠ¥å‘Š
```

---

## ğŸ”§ æ’ä»¶ç®¡ç†å™¨ï¼ˆPlugin Managerï¼‰

### æ ¸å¿ƒåŠŸèƒ½

```python
# plugins/manager.py
import importlib
import os
import yaml
from typing import Dict, List, Optional
from plugins.base import HIDRSPlugin

class PluginManager:
    """HIDRSæ’ä»¶ç®¡ç†å™¨"""

    def __init__(self, plugin_dir: str = 'plugins'):
        self.plugin_dir = plugin_dir
        self.plugins: Dict[str, HIDRSPlugin] = {}
        self.plugin_configs: Dict[str, Dict] = {}

    def discover_plugins(self) -> List[str]:
        """å‘ç°å¯ç”¨æ’ä»¶"""
        discovered = []
        for item in os.listdir(self.plugin_dir):
            plugin_path = os.path.join(self.plugin_dir, item)
            if os.path.isdir(plugin_path):
                config_file = os.path.join(plugin_path, 'config.yaml')
                if os.path.exists(config_file):
                    discovered.append(item)
        return discovered

    def load_plugin(self, plugin_name: str) -> bool:
        """åŠ è½½æ’ä»¶"""
        try:
            # è¯»å–æ’ä»¶é…ç½®
            config_path = os.path.join(
                self.plugin_dir,
                plugin_name,
                'config.yaml'
            )
            with open(config_path, 'r') as f:
                config = yaml.safe_load(f)

            # æ£€æŸ¥æ˜¯å¦å¯ç”¨
            if not config.get('enabled', False):
                logger.info(f"Plugin {plugin_name} is disabled")
                return False

            # åŠ¨æ€å¯¼å…¥æ’ä»¶æ¨¡å—
            module_path = f"plugins.{plugin_name}.plugin"
            module = importlib.import_module(module_path)

            # è·å–æ’ä»¶ç±»
            plugin_class_name = config['name']
            plugin_class = getattr(module, plugin_class_name)

            # è¯»å–ç”¨æˆ·é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            user_config_path = f"plugin_configs/{plugin_name}.yaml"
            if os.path.exists(user_config_path):
                with open(user_config_path, 'r') as f:
                    user_config = yaml.safe_load(f)
                config.update(user_config)

            # å®ä¾‹åŒ–æ’ä»¶
            plugin_instance = plugin_class(config)

            # éªŒè¯æƒé™
            if not self._check_permissions(plugin_instance):
                raise PermissionError(
                    f"Plugin {plugin_name} requires additional permissions"
                )

            # åˆå§‹åŒ–æ’ä»¶
            if plugin_instance.initialize():
                self.plugins[plugin_name] = plugin_instance
                self.plugin_configs[plugin_name] = config
                logger.info(f"Plugin {plugin_name} loaded successfully")
                return True
            else:
                logger.error(f"Plugin {plugin_name} initialization failed")
                return False

        except Exception as e:
            logger.error(f"Failed to load plugin {plugin_name}: {e}")
            return False

    def unload_plugin(self, plugin_name: str):
        """å¸è½½æ’ä»¶"""
        if plugin_name in self.plugins:
            self.plugins[plugin_name].shutdown()
            del self.plugins[plugin_name]
            logger.info(f"Plugin {plugin_name} unloaded")

    def get_plugin(self, plugin_name: str) -> Optional[HIDRSPlugin]:
        """è·å–æ’ä»¶å®ä¾‹"""
        return self.plugins.get(plugin_name)

    def is_enabled(self, plugin_name: str) -> bool:
        """æ£€æŸ¥æ’ä»¶æ˜¯å¦å¯ç”¨"""
        return plugin_name in self.plugins

    def list_plugins(self) -> Dict[str, Dict]:
        """åˆ—å‡ºæ‰€æœ‰æ’ä»¶"""
        return {
            name: {
                'enabled': self.is_enabled(name),
                'capabilities': plugin.get_capabilities() if self.is_enabled(name) else [],
                'config': self.plugin_configs.get(name, {})
            }
            for name, plugin in self.plugins.items()
        }

    def _check_permissions(self, plugin: HIDRSPlugin) -> bool:
        """æ£€æŸ¥æ’ä»¶æƒé™"""
        # å®ç°æƒé™æ£€æŸ¥é€»è¾‘
        required_perms = getattr(plugin, 'REQUIRED_PERMISSIONS', [])
        # è¿™é‡Œå¯ä»¥æ·»åŠ ç”¨æˆ·æˆæƒæµç¨‹
        return True  # æš‚æ—¶è¿”å›True
```

### Flask APIç«¯ç‚¹

```python
# backend/crawler_server.py
@app.route('/api/plugins', methods=['GET'])
def list_plugins():
    """åˆ—å‡ºæ‰€æœ‰æ’ä»¶"""
    return jsonify(plugin_manager.list_plugins())

@app.route('/api/plugins/<plugin_name>/enable', methods=['POST'])
def enable_plugin(plugin_name):
    """å¯ç”¨æ’ä»¶"""
    if plugin_manager.load_plugin(plugin_name):
        return jsonify({'success': True})
    return jsonify({'error': 'Failed to load plugin'}), 500

@app.route('/api/plugins/<plugin_name>/disable', methods=['POST'])
def disable_plugin(plugin_name):
    """ç¦ç”¨æ’ä»¶"""
    plugin_manager.unload_plugin(plugin_name)
    return jsonify({'success': True})
```

---

## ğŸ¨ å‰ç«¯UIè®¾è®¡

### æ’ä»¶ç®¡ç†é¡µé¢

```html
<!-- frontend/plugins.html -->
<div class="plugins-manager">
  <h2>æ’ä»¶ç®¡ç†</h2>

  <!-- æ’ä»¶åˆ—è¡¨ -->
  <div class="plugin-list">
    <!-- è®¾å¤‡æ‰«ææ’ä»¶ -->
    <div class="plugin-card">
      <div class="plugin-header">
        <h3>
          <i class="bi bi-router"></i> è®¾å¤‡æ‰«ææ’ä»¶
        </h3>
        <div class="plugin-status">
          <span class="badge bg-danger">æœªå¯ç”¨</span>
        </div>
      </div>
      <div class="plugin-body">
        <p>é›†æˆShodanã€Censysç­‰APIï¼Œæä¾›äº’è”ç½‘è®¾å¤‡æ‰«æå’Œæ¼æ´æƒ…æŠ¥ã€‚</p>
        <div class="plugin-capabilities">
          <span class="badge bg-info">Shodan</span>
          <span class="badge bg-info">Censys</span>
          <span class="badge bg-info">æ¼æ´æ‰«æ</span>
        </div>
      </div>
      <div class="plugin-footer">
        <button class="btn btn-sm btn-primary" onclick="configurePlugin('device_scanner')">
          <i class="bi bi-gear"></i> é…ç½®
        </button>
        <button class="btn btn-sm btn-success" onclick="enablePlugin('device_scanner')">
          <i class="bi bi-check-circle"></i> å¯ç”¨
        </button>
      </div>
    </div>

    <!-- æš—ç½‘çˆ¬è™«æ’ä»¶ -->
    <div class="plugin-card">
      <div class="plugin-header">
        <h3>
          <i class="bi bi-incognito"></i> æš—ç½‘çˆ¬è™«æ’ä»¶
        </h3>
        <div class="plugin-status">
          <span class="badge bg-warning">éœ€è¦é…ç½®</span>
        </div>
      </div>
      <div class="plugin-body">
        <p>æ”¯æŒTorã€I2Pç­‰åŒ¿åç½‘ç»œçš„çˆ¬è™«åŠŸèƒ½ï¼Œç”¨äºæš—ç½‘æƒ…æŠ¥æ”¶é›†ã€‚</p>
        <div class="alert alert-danger mt-2">
          <i class="bi bi-exclamation-triangle"></i>
          <strong>è­¦å‘Šï¼š</strong>ä»…ç”¨äºåˆæ³•çš„å®‰å…¨ç ”ç©¶å’Œå¨èƒæƒ…æŠ¥æ”¶é›†ã€‚
        </div>
        <div class="plugin-capabilities">
          <span class="badge bg-dark">Tor</span>
          <span class="badge bg-dark">I2P</span>
        </div>
      </div>
      <div class="plugin-footer">
        <button class="btn btn-sm btn-primary" onclick="configurePlugin('darkweb_crawler')">
          <i class="bi bi-gear"></i> é…ç½®
        </button>
        <button class="btn btn-sm btn-warning" onclick="showConsentDialog('darkweb_crawler')">
          <i class="bi bi-file-text"></i> æŸ¥çœ‹æ¡æ¬¾
        </button>
      </div>
    </div>
  </div>
</div>

<!-- æ’ä»¶é…ç½®å¯¹è¯æ¡† -->
<div class="modal" id="plugin-config-modal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">æ’ä»¶é…ç½®</h5>
      </div>
      <div class="modal-body">
        <form id="plugin-config-form">
          <!-- åŠ¨æ€ç”Ÿæˆé…ç½®è¡¨å• -->
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="savePluginConfig()">ä¿å­˜</button>
      </div>
    </div>
  </div>
</div>
```

### è®¾å¤‡æ‰«æç•Œé¢

```html
<!-- è®¾å¤‡æ‰«æä¸“ç”¨ç•Œé¢ -->
<div class="device-scanner-panel">
  <h4>
    <i class="bi bi-router"></i> è®¾å¤‡æ‰«æ
  </h4>

  <div class="search-form">
    <div class="input-group">
      <select class="form-select" style="max-width: 150px;" id="scan-type">
        <option value="shodan">Shodan</option>
        <option value="censys">Censys</option>
        <option value="zoomeye">ZoomEye</option>
      </select>
      <input type="text" class="form-control" id="scan-query"
             placeholder="ä¾‹å¦‚: apache country:CN">
      <button class="btn btn-primary" onclick="performDeviceScan()">
        <i class="bi bi-search"></i> æ‰«æ
      </button>
    </div>

    <div class="mt-2">
      <small class="text-muted">
        <strong>ç¤ºä¾‹æŸ¥è¯¢ï¼š</strong>
        "apache country:CN" | "port:22" | "org:\"Amazon\"" | "product:nginx"
      </small>
    </div>
  </div>

  <!-- æ‰«æç»“æœ -->
  <div class="scan-results mt-4" id="scan-results">
    <!-- åŠ¨æ€åŠ è½½ -->
  </div>
</div>
```

---

## ğŸ“Š æ’ä»¶å¼€å‘æŒ‡å—

### åˆ›å»ºæ–°æ’ä»¶çš„æ­¥éª¤

1. **åˆ›å»ºæ’ä»¶ç›®å½•**
   ```bash
   mkdir -p plugins/my_plugin
   cd plugins/my_plugin
   ```

2. **åˆ›å»ºæ’ä»¶æ–‡ä»¶**
   ```bash
   touch __init__.py
   touch plugin.py
   touch config.yaml
   ```

3. **å®ç°æ’ä»¶ç±»**
   ```python
   # plugins/my_plugin/plugin.py
   from plugins.base import HIDRSPlugin

   class MyPlugin(HIDRSPlugin):
       def initialize(self) -> bool:
           # åˆå§‹åŒ–é€»è¾‘
           return True

       def execute(self, query: str, **kwargs):
           # æ‰§è¡Œé€»è¾‘
           return []

       def validate_config(self) -> bool:
           # é…ç½®éªŒè¯
           return True
   ```

4. **ç¼–å†™é…ç½®æ–‡ä»¶**
   ```yaml
   # plugins/my_plugin/config.yaml
   name: MyPlugin
   version: 1.0.0
   enabled: false
   ```

5. **æµ‹è¯•æ’ä»¶**
   ```python
   from plugins.manager import PluginManager

   pm = PluginManager()
   pm.load_plugin('my_plugin')
   ```

---

## âš–ï¸ åˆè§„æ€§ä¸å®‰å…¨

### æ³•å¾‹åˆè§„

| æ’ä»¶ | æ³•å¾‹é£é™© | åˆè§„æªæ–½ |
|------|---------|---------|
| è®¾å¤‡æ‰«æ | âš ï¸ ä¸­ | â€¢ è®°å½•æ‰€æœ‰æŸ¥è¯¢<br>â€¢ ç”¨æˆ·åŒæ„æ¡æ¬¾<br>â€¢ é€Ÿç‡é™åˆ¶ |
| æš—ç½‘çˆ¬è™« | ğŸ”´ é«˜ | â€¢ å¼ºåˆ¶åŒæ„<br>â€¢ å†…å®¹é»‘åå•<br>â€¢ è®¿é—®æ—¥å¿—<br>â€¢ éæ³•å†…å®¹æŠ¥å‘Š |

### æ•°æ®ä¿æŠ¤

- æ‰€æœ‰æ’ä»¶æŸ¥è¯¢æ—¥å¿—ä¿ç•™90å¤©
- APIå¯†é’¥åŠ å¯†å­˜å‚¨
- æ•æ„Ÿæ•°æ®è„±æ•å¤„ç†
- å®šæœŸå®‰å…¨å®¡è®¡

### ç”¨æˆ·è´£ä»»å£°æ˜

```
HIDRSæ’ä»¶ç³»ç»Ÿç”¨æˆ·åè®®

ä½¿ç”¨HIDRSæ’ä»¶ç³»ç»Ÿå³è¡¨ç¤ºæ‚¨åŒæ„ï¼š

1. ä»…å°†æ’ä»¶ç”¨äºåˆæ³•ç›®çš„
2. éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
3. ä¸ä¾µçŠ¯ä»–äººéšç§
4. ä¸å‚ä¸éæ³•æ´»åŠ¨
5. å¯¹ä½¿ç”¨æ’ä»¶çš„åæœè´Ÿå…¨éƒ¨è´£ä»»

ç‰¹åˆ«è­¦å‘Šï¼š
- è®¾å¤‡æ‰«ææ’ä»¶å¯èƒ½è§¦å‘ç›®æ ‡ç³»ç»Ÿçš„å…¥ä¾µæ£€æµ‹
- æš—ç½‘çˆ¬è™«æ’ä»¶è®¿é—®çš„å†…å®¹å¯èƒ½æ¶‰åŠéæ³•æ´»åŠ¨
- æ’ä»¶ä½œè€…å’ŒHIDRSé¡¹ç›®ä¸å¯¹ç”¨æˆ·è¡Œä¸ºè´Ÿè´£
```

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¶æ„ï¼ˆ2-3å‘¨ï¼‰

- [ ] å®ç°æ’ä»¶åŸºç±»å’Œç®¡ç†å™¨
- [ ] è®¾è®¡æ’ä»¶é…ç½®ç³»ç»Ÿ
- [ ] å®ç°æƒé™ç®¡ç†æœºåˆ¶
- [ ] ç¼–å†™æ’ä»¶å¼€å‘æ–‡æ¡£

### Phase 2: è®¾å¤‡æ‰«ææ’ä»¶ï¼ˆ1-2å‘¨ï¼‰

- [ ] å®ç°Shodan APIé›†æˆ
- [ ] å®ç°Censys APIé›†æˆ
- [ ] è®¾è®¡è®¾å¤‡æ‰«æUI
- [ ] ç¼–å†™ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

### Phase 3: æš—ç½‘çˆ¬è™«æ’ä»¶ï¼ˆ2-3å‘¨ï¼‰

- [ ] å®ç°Torçˆ¬è™«
- [ ] å®ç°åˆè§„æ€§æ£€æŸ¥
- [ ] è®¾è®¡æš—ç½‘æœç´¢UI
- [ ] ç¼–å†™å®‰å…¨ä½¿ç”¨æŒ‡å—

### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] å®‰å…¨å®¡è®¡
- [ ] æ€§èƒ½ä¼˜åŒ–

### æ€»è®¡å¼€å‘æ—¶é—´ï¼š6-10å‘¨

---

## ğŸ“š å‚è€ƒèµ„æ–™

### æŠ€æœ¯æ–‡æ¡£
- [Shodan APIæ–‡æ¡£](https://developer.shodan.io/)
- [Censys APIæ–‡æ¡£](https://search.censys.io/api)
- [Tor Project](https://www.torproject.org/docs/)
- [Stemåº“æ–‡æ¡£](https://stem.torproject.org/)

### ç›¸å…³æ–‡ä»¶
- `/home/user/hidrs/HIDRS-VS-MAINSTREAM-OSINT-TOOLS.md` - OSINTå·¥å…·å¯¹æ¯”
- `/home/user/hidrs/CLAUDE.md` - HIDRSé¡¹ç›®è¯´æ˜
- `/home/user/hidrs/HIDRS-ADVANCED-SEARCH-PLAN.md` - é«˜çº§æœç´¢è§„åˆ’

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**åˆ›å»ºæ—¶é—´**: 2026-02-05
**ä½œè€…**: HIDRS Team
**çŠ¶æ€**: è§„åˆ’é˜¶æ®µ
