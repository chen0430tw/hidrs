<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'&gt;&lt;text y='.9em' font-size='90'&gt;ğŸ§¿&lt;/text&gt;&lt;/svg&gt;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIRY-DESK - èˆ¹èˆ¶è¿½è¸ª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #0a0e17;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .toolbar {
      height: 40px;
      background: rgba(17, 24, 39, 0.95);
      border-bottom: 1px solid rgba(0, 240, 255, 0.2);
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 12px;
    }
    .toolbar .title {
      color: #00f0ff;
      font-size: 13px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .toolbar .provider-tabs {
      display: flex;
      gap: 4px;
      margin-left: auto;
    }
    .toolbar .provider-tabs button {
      padding: 6px 14px;
      background: transparent;
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      cursor: pointer;
      font-size: 12px;
    }
    .toolbar .provider-tabs button:hover {
      border-color: #00f0ff;
      color: #e5e7eb;
    }
    .toolbar .provider-tabs button.active {
      background: rgba(0, 240, 255, 0.2);
      border-color: #00f0ff;
      color: #00f0ff;
    }
    .frame-container {
      flex: 1;
      position: relative;
    }
    .frame-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .fallback {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #0a0e17;
      color: #e5e7eb;
      text-align: center;
      padding: 40px;
    }
    .fallback.visible {
      display: flex;
    }
    .fallback .icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    .fallback h2 {
      color: #00f0ff;
      margin-bottom: 16px;
      font-weight: normal;
    }
    .fallback p {
      color: #9ca3af;
      margin-bottom: 24px;
      max-width: 400px;
      line-height: 1.6;
    }
    .fallback .buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .fallback button {
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .fallback button.primary {
      background: #00f0ff;
      color: #0a0e17;
      border: none;
    }
    .fallback button.secondary {
      background: transparent;
      color: #00f0ff;
      border: 1px solid #00f0ff;
    }
    .fallback button:hover {
      opacity: 0.9;
    }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #00f0ff;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 5;
    }
    .loading.hidden {
      display: none;
    }
    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 2px solid rgba(0, 240, 255, 0.2);
      border-top-color: #00f0ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="title">
      <span>ğŸš¢</span>
      <span>èˆ¹èˆ¶è¿½è¸ª</span>
    </div>
    <div class="provider-tabs">
      <button class="active" data-provider="marinetraffic" onclick="switchProvider('marinetraffic')">MarineTraffic</button>
      <button data-provider="vesselfinder" onclick="switchProvider('vesselfinder')">VesselFinder</button>
    </div>
  </div>

  <div class="frame-container" id="frame-container">
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <span>åŠ è½½ä¸­...</span>
    </div>

    <!-- åµŒå…¥å¸§ç”± JS åŠ¨æ€ç”Ÿæˆ -->

    <div class="fallback" id="fallback">
      <div class="icon">ğŸš¢</div>
      <h2>èˆ¹èˆ¶è¿½è¸ªæœåŠ¡</h2>
      <p>åµŒå…¥åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·å°è¯•åœ¨æ–°çª—å£ä¸­æ‰“å¼€ã€‚</p>
      <div class="buttons">
        <button class="primary" onclick="window.open('https://www.marinetraffic.com/', '_blank')">
          ğŸŒŠ æ‰“å¼€ MarineTraffic
        </button>
        <button class="secondary" onclick="window.open('https://www.vesselfinder.com/', '_blank')">
          ğŸ” æ‰“å¼€ VesselFinder
        </button>
      </div>
    </div>
  </div>

  <script>
    // å®˜æ–¹ JS Embed ä½¿ç”¨ document.write()ï¼Œåªèƒ½åœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œã€‚
    // è§£å†³æ–¹æ¡ˆï¼šç”¨ srcdoc iframe ä¸ºæ¯ä¸ª provider åˆ›å»ºç‹¬ç«‹çš„æ–‡æ¡£ä¸Šä¸‹æ–‡ï¼Œ
    // è®©å®˜æ–¹ embed.js / aismap.js åœ¨å…¶ä¸­æ­£å¸¸è¿è¡Œã€‚

    const providers = {
      marinetraffic: {
        // MarineTraffic å®˜æ–¹ embed.js åµŒå…¥
        // å‚æ•°: width, height, latitude(â†’centery), longitude(â†’centerx), zoom, maptype, shownames, trackvessel, fleet
        buildSrcdoc: function() {
          return '<!DOCTYPE html>' +
            '<html style="height:100%;margin:0">' +
            '<head><style>*{margin:0;padding:0}html,body{height:100%;overflow:hidden}body iframe{width:100%!important;height:100%!important}</style></head>' +
            '<body style="height:100%">' +
            '<script>' +
            'var width="100%";' +
            'var height="100%";' +
            'var border=0;' +
            'var latitude=25;' +
            'var longitude=125;' +
            'var zoom=4;' +
            'var maptype=4;' +
            'var shownames=true;' +
            'var trackvessel=0;' +
            'var fleet="";' +
            'var showmenu=false;' +
            'var remember=false;' +
            '<\/script>' +
            '<script src="https://www.marinetraffic.com/js/embed.js"><\/script>' +
            '</body></html>';
        },
        fallbackUrl: 'https://www.marinetraffic.com/'
      },
      vesselfinder: {
        // VesselFinder å®˜æ–¹ aismap.js åµŒå…¥
        // å‚æ•°: width, height, latitude, longitude, zoom, names, mmsi, imo, show_track, fleet
        buildSrcdoc: function() {
          return '<!DOCTYPE html>' +
            '<html style="height:100%;margin:0">' +
            '<head><style>*{margin:0;padding:0}html,body{height:100%;overflow:hidden}body iframe{width:100%!important;height:100%!important}</style></head>' +
            '<body style="height:100%">' +
            '<script>' +
            'var width="100%";' +
            'var height="100%";' +
            'var latitude=25;' +
            'var longitude=125;' +
            'var zoom=4;' +
            'var names=true;' +
            '<\/script>' +
            '<script src="https://www.vesselfinder.com/aismap.js"><\/script>' +
            '</body></html>';
        },
        fallbackUrl: 'https://www.vesselfinder.com/'
      }
    };

    let currentProvider = 'marinetraffic';
    let loadTimeoutId = null;

    function switchProvider(provider) {
      if (!providers[provider]) return;
      currentProvider = provider;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.provider-tabs button').forEach(function(btn) {
        btn.classList.toggle('active', btn.dataset.provider === provider);
      });

      loadProvider(provider);
    }

    function loadProvider(provider) {
      var container = document.getElementById('frame-container');
      var loading = document.getElementById('loading');
      var fallback = document.getElementById('fallback');

      // æ¸…é™¤ä¸Šä¸€æ¬¡çš„è¶…æ—¶è®¡æ—¶å™¨
      if (loadTimeoutId) {
        clearTimeout(loadTimeoutId);
        loadTimeoutId = null;
      }

      // ç§»é™¤æ—§çš„ iframe
      var oldFrame = document.getElementById('marine-frame');
      if (oldFrame) {
        oldFrame.remove();
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      loading.classList.remove('hidden');
      fallback.classList.remove('visible');

      // åˆ›å»ºæ–° iframeï¼Œä½¿ç”¨ srcdoc æ³¨å…¥å®˜æ–¹ embed è„šæœ¬
      var config = providers[provider];
      var frame = document.createElement('iframe');
      frame.id = 'marine-frame';
      frame.setAttribute('allowfullscreen', '');
      frame.setAttribute('loading', 'lazy');
      frame.srcdoc = config.buildSrcdoc();

      frame.onload = function() {
        loading.classList.add('hidden');
      };

      frame.onerror = function() {
        showFallback();
      };

      container.appendChild(frame);

      // è¶…æ—¶ä¿æŠ¤ï¼š8ç§’åå¦‚æœä»åœ¨åŠ è½½åˆ™éšè— loading
      loadTimeoutId = setTimeout(function() {
        if (!loading.classList.contains('hidden')) {
          loading.classList.add('hidden');
        }
      }, 8000);
    }

    function showFallback() {
      document.getElementById('loading').classList.add('hidden');
      var frame = document.getElementById('marine-frame');
      if (frame) {
        frame.style.display = 'none';
      }
      document.getElementById('fallback').classList.add('visible');
    }

    // åˆå§‹åŠ è½½
    loadProvider(currentProvider);
  </script>
</body>
</html>
