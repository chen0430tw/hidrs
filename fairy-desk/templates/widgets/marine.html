<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIRY-DESK - èˆ¹èˆ¶è¿½è¸ª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #0a0e17;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .toolbar {
      height: 40px;
      background: rgba(17, 24, 39, 0.95);
      border-bottom: 1px solid rgba(0, 240, 255, 0.2);
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 12px;
    }
    .toolbar .title {
      color: #00f0ff;
      font-size: 13px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .toolbar .provider-tabs {
      display: flex;
      gap: 4px;
      margin-left: auto;
    }
    .toolbar .provider-tabs button {
      padding: 6px 14px;
      background: transparent;
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      cursor: pointer;
      font-size: 12px;
    }
    .toolbar .provider-tabs button:hover {
      border-color: #00f0ff;
      color: #e5e7eb;
    }
    .toolbar .provider-tabs button.active {
      background: rgba(0, 240, 255, 0.2);
      border-color: #00f0ff;
      color: #00f0ff;
    }
    .frame-container {
      flex: 1;
      position: relative;
    }
    .frame-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .fallback {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #0a0e17;
      color: #e5e7eb;
      text-align: center;
      padding: 40px;
    }
    .fallback.hidden {
      display: none;
    }
    .fallback .icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    .fallback h2 {
      color: #00f0ff;
      margin-bottom: 16px;
      font-weight: normal;
    }
    .fallback p {
      color: #9ca3af;
      margin-bottom: 24px;
      max-width: 400px;
      line-height: 1.6;
    }
    .fallback .buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .fallback button {
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .fallback button.primary {
      background: #00f0ff;
      color: #0a0e17;
      border: none;
    }
    .fallback button.secondary {
      background: transparent;
      color: #00f0ff;
      border: 1px solid #00f0ff;
    }
    .fallback button:hover {
      opacity: 0.9;
    }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #00f0ff;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 2px solid rgba(0, 240, 255, 0.2);
      border-top-color: #00f0ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="title">
      <span>ğŸš¢</span>
      <span>èˆ¹èˆ¶è¿½è¸ª</span>
    </div>
    <div class="provider-tabs">
      <button class="active" onclick="switchProvider('marinetraffic')">MarineTraffic</button>
      <button onclick="switchProvider('vesselfinder')">VesselFinder</button>
    </div>
  </div>

  <div class="frame-container">
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <span>åŠ è½½ä¸­...</span>
    </div>

    <iframe id="marine-frame" src="" style="display: none;"></iframe>

    <div class="fallback" id="fallback">
      <div class="icon">ğŸš¢</div>
      <h2>èˆ¹èˆ¶è¿½è¸ªæœåŠ¡</h2>
      <p>
        ç”±äºå®‰å…¨ç­–ç•¥é™åˆ¶ï¼Œéƒ¨åˆ†èˆ¹èˆ¶è¿½è¸ªç½‘ç«™æ— æ³•åœ¨åµŒå…¥æ¨¡å¼ä¸‹æ˜¾ç¤ºã€‚
        è¯·é€‰æ‹©ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š
      </p>
      <div class="buttons">
        <button class="primary" onclick="window.open('https://www.marinetraffic.com/', '_blank')">
          ğŸŒŠ æ‰“å¼€ MarineTraffic
        </button>
        <button class="secondary" onclick="window.open('https://www.vesselfinder.com/', '_blank')">
          ğŸ” æ‰“å¼€ VesselFinder
        </button>
      </div>
    </div>
  </div>

  <script>
    const providers = {
      marinetraffic: {
        // MarineTraffic å®˜æ–¹åµŒå…¥åœ°å›¾
        embedUrl: 'https://www.marinetraffic.com/en/ais/embed/zoom:4/centery:35/centerx:140/maptype:4/shownames:true/mmsi:0/shipid:0/fleet:/fleet_id:/vtypes:/showmenu:/remember:false',
        fallbackUrl: 'https://www.marinetraffic.com/'
      },
      vesselfinder: {
        // VesselFinder å®˜æ–¹åµŒå…¥
        embedUrl: 'https://www.vesselfinder.com/aismap?lat=35&lon=140&zoom=4&width=100%&height=100%',
        fallbackUrl: 'https://www.vesselfinder.com/'
      }
    };

    let currentProvider = 'marinetraffic';

    function switchProvider(provider) {
      currentProvider = provider;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.provider-tabs button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(provider));
      });

      loadProvider(provider);
    }

    function loadProvider(provider) {
      const frame = document.getElementById('marine-frame');
      const loading = document.getElementById('loading');
      const fallback = document.getElementById('fallback');

      loading.style.display = 'flex';
      frame.style.display = 'none';
      fallback.classList.add('hidden');

      const config = providers[provider];
      frame.src = config.embedUrl;

      // æ£€æµ‹æ˜¯å¦åŠ è½½æˆåŠŸ
      frame.onload = function() {
        loading.style.display = 'none';
        try {
          // å°è¯•è®¿é—® iframe å†…å®¹ï¼Œå¦‚æœè¢«é˜»æ­¢ä¼šæŠ›å‡ºé”™è¯¯
          const doc = frame.contentDocument || frame.contentWindow.document;
          frame.style.display = 'block';
        } catch (e) {
          // X-Frame-Options é˜»æ­¢ï¼Œæ˜¾ç¤º fallback
          showFallback();
        }
      };

      frame.onerror = function() {
        showFallback();
      };

      // è¶…æ—¶æ£€æµ‹
      setTimeout(() => {
        if (loading.style.display !== 'none') {
          // å¯èƒ½æ˜¯é™é»˜å¤±è´¥ï¼Œæ£€æŸ¥ iframe
          if (!frame.contentWindow || frame.style.display === 'none') {
            showFallback();
          } else {
            loading.style.display = 'none';
            frame.style.display = 'block';
          }
        }
      }, 5000);
    }

    function showFallback() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('marine-frame').style.display = 'none';
      document.getElementById('fallback').classList.remove('hidden');
    }

    // åˆå§‹åŠ è½½
    loadProvider(currentProvider);
  </script>
</body>
</html>
