<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'&gt;&lt;text y='.9em' font-size='90'&gt;ğŸ§¿&lt;/text&gt;&lt;/svg&gt;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIRY-DESK - åœ°å›¾</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #0a0e17;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    #map {
      width: 100vw;
      height: 100vh;
    }
    /* è‡ªå®šä¹‰æ§ä»¶æ ·å¼ */
    .leaflet-control-zoom a {
      background: rgba(17, 24, 39, 0.9) !important;
      color: #00f0ff !important;
      border: 1px solid rgba(0, 240, 255, 0.3) !important;
    }
    .leaflet-control-zoom a:hover {
      background: rgba(0, 240, 255, 0.2) !important;
    }
    .leaflet-control-attribution {
      background: rgba(17, 24, 39, 0.8) !important;
      color: #9ca3af !important;
      font-size: 10px !important;
    }
    .leaflet-control-attribution a {
      color: #00f0ff !important;
    }
    /* æœç´¢æ¡† */
    .map-search {
      position: absolute;
      top: 10px;
      left: 50px;
      z-index: 1000;
      display: flex;
      gap: 4px;
    }
    .map-search input {
      width: 250px;
      padding: 8px 12px;
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      color: #e5e7eb;
      font-size: 13px;
    }
    .map-search input:focus {
      outline: none;
      border-color: #00f0ff;
      box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
    }
    .map-search button {
      padding: 8px 16px;
      background: rgba(0, 240, 255, 0.2);
      border: 1px solid rgba(0, 240, 255, 0.5);
      border-radius: 4px;
      color: #00f0ff;
      cursor: pointer;
      font-size: 13px;
    }
    .map-search button:hover {
      background: rgba(0, 240, 255, 0.3);
    }
    /* ä¿¡æ¯é¢æ¿ */
    .info-panel {
      position: absolute;
      bottom: 30px;
      left: 10px;
      z-index: 1000;
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      padding: 10px 14px;
      color: #e5e7eb;
      font-size: 12px;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }
    .info-panel .coord {
      color: #00f0ff;
    }
    /* å¿«æ·ä½ç½®æŒ‰é’® */
    .quick-locations {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .quick-locations button {
      padding: 6px 12px;
      background: rgba(17, 24, 39, 0.9);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      cursor: pointer;
      font-size: 11px;
      text-align: left;
    }
    .quick-locations button:hover {
      background: rgba(0, 240, 255, 0.1);
      color: #00f0ff;
      border-color: rgba(0, 240, 255, 0.5);
    }
    /* å›¾å±‚åˆ‡æ¢å™¨ */
    .layer-switcher {
      position: absolute;
      bottom: 30px;
      right: 10px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .layer-switcher button {
      padding: 6px 12px;
      background: rgba(17, 24, 39, 0.9);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 4px;
      color: #9ca3af;
      cursor: pointer;
      font-size: 11px;
      text-align: left;
    }
    .layer-switcher button:hover {
      background: rgba(0, 240, 255, 0.1);
      color: #00f0ff;
      border-color: rgba(0, 240, 255, 0.5);
    }
    .layer-switcher button.active {
      color: #00f0ff;
      border-color: #00f0ff;
      background: rgba(0, 240, 255, 0.15);
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="map-search">
    <input type="text" id="search-input" placeholder="æœç´¢åœ°ç‚¹..." onkeypress="if(event.key==='Enter')searchLocation()">
    <button onclick="searchLocation()">ğŸ”</button>
  </div>

  <div class="quick-locations">
    <button onclick="flyTo(35.6762, 139.6503, 12)">ğŸ—¼ ä¸œäº¬</button>
    <button onclick="flyTo(25.0330, 121.5654, 12)">ğŸ™ï¸ å°åŒ—</button>
    <button onclick="flyTo(31.2304, 121.4737, 12)">ğŸŒ† ä¸Šæµ·</button>
    <button onclick="flyTo(37.7749, -122.4194, 12)">ğŸŒ‰ æ—§é‡‘å±±</button>
    <button onclick="flyTo(51.5074, -0.1278, 12)">ğŸ¡ ä¼¦æ•¦</button>
  </div>

  <div class="info-panel">
    <div>LAT: <span class="coord" id="lat">--</span></div>
    <div>LNG: <span class="coord" id="lng">--</span></div>
    <div>ZOOM: <span class="coord" id="zoom">--</span></div>
  </div>

  <div class="layer-switcher">
    <button class="active" id="btn-satellite" onclick="switchLayer('satellite')">ğŸ›°ï¸ å«æ˜Ÿ</button>
    <button id="btn-google" onclick="switchLayer('google')">ğŸŒ Google</button>
    <button id="btn-dark" onclick="switchLayer('dark')">ğŸŒ‘ æš—è‰²</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // å›¾å±‚å®šä¹‰
    var layers = {
      satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '&copy; <a href="https://www.esri.com/">Esri</a> &mdash; Source: Esri, Maxar, Earthstar Geographics',
        maxZoom: 19
      }),
      google: L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        attribution: '&copy; Google Maps',
        maxZoom: 20
      }),
      dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 19
      })
    };

    // Esri å«æ˜Ÿæ ‡æ³¨è¦†ç›–å±‚ï¼ˆåœ¨å«æ˜Ÿè§†å›¾ä¸Šæ˜¾ç¤ºåœ°åï¼‰
    var labelsOverlay = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
      maxZoom: 19,
      pane: 'overlayPane'
    });

    var currentLayerName = 'satellite';

    // åˆå§‹åŒ–åœ°å›¾ï¼ˆé»˜è®¤å«æ˜Ÿå›¾å±‚ï¼‰
    const map = L.map('map', {
      center: [35.6762, 139.6503],
      zoom: 4,
      zoomControl: true,
      layers: [layers.satellite, labelsOverlay]
    });

    function switchLayer(name) {
      // ç§»é™¤å½“å‰å›¾å±‚
      map.removeLayer(layers[currentLayerName]);
      map.removeLayer(labelsOverlay);

      // æ·»åŠ æ–°å›¾å±‚
      layers[name].addTo(map);
      // å«æ˜Ÿè§†å›¾åŠ æ ‡æ³¨è¦†ç›–å±‚
      if (name === 'satellite') {
        labelsOverlay.addTo(map);
      }
      currentLayerName = name;

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.layer-switcher button').forEach(function(btn) {
        btn.classList.toggle('active', btn.id === 'btn-' + name);
      });
    }

    // æ›´æ–°åæ ‡æ˜¾ç¤º
    function updateInfo() {
      const center = map.getCenter();
      document.getElementById('lat').textContent = center.lat.toFixed(4);
      document.getElementById('lng').textContent = center.lng.toFixed(4);
      document.getElementById('zoom').textContent = map.getZoom();
    }

    map.on('move', updateInfo);
    map.on('zoom', updateInfo);
    updateInfo();

    // é£åˆ°æŒ‡å®šä½ç½®
    function flyTo(lat, lng, zoom) {
      map.flyTo([lat, lng], zoom, {
        duration: 1.5
      });
    }

    // æœç´¢ä½ç½®
    async function searchLocation() {
      const query = document.getElementById('search-input').value.trim();
      if (!query) return;

      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`
        );
        const results = await response.json();

        if (results.length > 0) {
          const result = results[0];
          flyTo(parseFloat(result.lat), parseFloat(result.lon), 14);

          // æ·»åŠ æ ‡è®°
          L.marker([result.lat, result.lon])
            .addTo(map)
            .bindPopup(`<b>${result.display_name}</b>`)
            .openPopup();
        } else {
          alert('æœªæ‰¾åˆ°è¯¥ä½ç½®');
        }
      } catch (error) {
        console.error('æœç´¢å¤±è´¥:', error);
        alert('æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // ç‚¹å‡»åœ°å›¾æ·»åŠ æ ‡è®°
    map.on('click', function(e) {
      L.marker([e.latlng.lat, e.latlng.lng])
        .addTo(map)
        .bindPopup(`<b>æ ‡è®°ç‚¹</b><br>LAT: ${e.latlng.lat.toFixed(4)}<br>LNG: ${e.latlng.lng.toFixed(4)}`)
        .openPopup();
    });
  </script>
</body>
</html>
