<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'&gt;&lt;text y='.9em' font-size='90'&gt;ğŸ§¿&lt;/text&gt;&lt;/svg&gt;">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIRY-DESK - ç¤¾äº¤åª’ä½“</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0e17;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #e5e7eb;
    }

    /* é¡¶éƒ¨å¹³å°åˆ‡æ¢æ  */
    .platform-tabs {
      display: flex;
      background: rgba(17, 24, 39, 0.95);
      border-bottom: 1px solid rgba(0, 240, 255, 0.2);
      padding: 0 8px;
      gap: 4px;
      overflow-x: auto;
    }

    .platform-tab {
      padding: 10px 16px;
      background: transparent;
      border: none;
      color: #6b7280;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .platform-tab:hover {
      color: #e5e7eb;
      background: rgba(255, 255, 255, 0.05);
    }

    .platform-tab.active {
      color: #00f0ff;
      border-bottom-color: #00f0ff;
    }

    .platform-tab .icon {
      font-size: 14px;
    }

    /* å†…å®¹åŒºåŸŸ */
    .content-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .platform-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      flex-direction: column;
    }

    .platform-content.active {
      display: flex;
    }

    /* iframe å®¹å™¨ */
    .embed-container {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    .embed-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Twitter Timeline å®¹å™¨ */
    .twitter-timeline-container {
      flex: 1;
      overflow: auto;
      position: relative;
      background: #0a0e17;
    }

    /* Fallback UI */
    .fallback-ui {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
      text-align: center;
    }

    .fallback-ui .platform-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .fallback-ui h3 {
      color: #00f0ff;
      font-size: 16px;
      font-weight: normal;
      margin-bottom: 8px;
    }

    .fallback-ui p {
      color: #6b7280;
      font-size: 12px;
      margin-bottom: 20px;
      max-width: 280px;
      line-height: 1.6;
    }

    .fallback-ui .open-btn {
      padding: 10px 24px;
      background: rgba(0, 240, 255, 0.15);
      border: 1px solid #00f0ff;
      border-radius: 6px;
      color: #00f0ff;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .fallback-ui .open-btn:hover {
      background: #00f0ff;
      color: #0a0e17;
    }

    /* è‡ªåŠ¨è½®æ’­æŒ‡ç¤ºå™¨ */
    .carousel-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 8px;
      background: rgba(17, 24, 39, 0.8);
      border-top: 1px solid rgba(0, 240, 255, 0.1);
    }

    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #374151;
      cursor: pointer;
      transition: all 0.2s;
    }

    .carousel-dot.active {
      background: #00f0ff;
      box-shadow: 0 0 8px #00f0ff;
    }

    .carousel-toggle {
      background: transparent;
      border: 1px solid #374151;
      color: #6b7280;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      margin-left: 12px;
    }

    .carousel-toggle:hover {
      border-color: #00f0ff;
      color: #00f0ff;
    }

    .carousel-toggle.playing {
      border-color: #00f0ff;
      color: #00f0ff;
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0e17;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .loading-overlay.hidden {
      display: none;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 2px solid rgba(0, 240, 255, 0.2);
      border-top-color: #00f0ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* å¿«æ·æ“ä½œæ  */
    .quick-actions {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: rgba(17, 24, 39, 0.6);
      border-bottom: 1px solid rgba(0, 240, 255, 0.1);
    }

    .quick-action {
      flex: 1;
      padding: 8px;
      background: rgba(0, 240, 255, 0.08);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 4px;
      color: #9ca3af;
      font-size: 11px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .quick-action:hover {
      background: rgba(0, 240, 255, 0.15);
      color: #00f0ff;
      border-color: #00f0ff;
    }

    /* Twitter å¸å·åˆ‡æ¢æ  */
    .account-bar {
      display: flex;
      gap: 6px;
      padding: 8px 10px;
      background: rgba(17, 24, 39, 0.6);
      border-bottom: 1px solid rgba(0, 240, 255, 0.1);
      overflow-x: auto;
      align-items: center;
    }

    .account-chip {
      padding: 4px 12px;
      border-radius: 20px;
      border: 1px solid #374151;
      background: transparent;
      color: #9ca3af;
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .account-chip:hover {
      border-color: #00f0ff;
      color: #00f0ff;
    }

    .account-chip.active {
      border-color: #00f0ff;
      background: rgba(0, 240, 255, 0.15);
      color: #00f0ff;
    }
  </style>
</head>
<body>
  <!-- å¹³å°åˆ‡æ¢æ ‡ç­¾ -->
  <div class="platform-tabs">
    <button class="platform-tab active" data-platform="x" onclick="switchPlatform('x')">
      <span class="icon">ğ•</span>
      <span>X / Twitter</span>
    </button>
    <button class="platform-tab" data-platform="threads" onclick="switchPlatform('threads')">
      <span class="icon">ğŸ”—</span>
      <span>Threads</span>
    </button>
    <button class="platform-tab" data-platform="bluesky" onclick="switchPlatform('bluesky')">
      <span class="icon">ğŸ¦‹</span>
      <span>Bluesky</span>
    </button>
    <button class="platform-tab" data-platform="mastodon" onclick="switchPlatform('mastodon')">
      <span class="icon">ğŸ˜</span>
      <span>Mastodon</span>
    </button>
    <button class="platform-tab" data-platform="reddit" onclick="switchPlatform('reddit')">
      <span class="icon">ğŸ¤–</span>
      <span>Reddit</span>
    </button>
    <button class="platform-tab" data-platform="weibo" onclick="switchPlatform('weibo')">
      <span class="icon">ğŸ”´</span>
      <span>å¾®åš</span>
    </button>
  </div>

  <!-- å†…å®¹åŒºåŸŸ -->
  <div class="content-area">
    <!-- X / Twitter (Syndication Timeline Proxy) -->
    <div class="platform-content active" id="content-x">
      <div class="account-bar" id="twitter-accounts">
        <!-- ç”± JS ä»é…ç½®å¡«å……å¸å·åˆ—è¡¨ -->
      </div>
      <div class="embed-container" id="twitter-container">
        <div class="loading-overlay" id="loading-x">
          <div class="loading-spinner"></div>
        </div>
        <iframe id="twitter-iframe" src=""
                onload="hideLoading('x')"
                onerror="showTwitterFallback()"
                style="width:100%;height:100%;border:none;background:#0a0e17;"></iframe>
      </div>
    </div>

    <!-- Threads -->
    <div class="platform-content" id="content-threads">
      <div class="fallback-ui">
        <div class="platform-icon">ğŸ”—</div>
        <h3>Threads by Meta</h3>
        <p>Threads ç›®å‰ä¸æ”¯æŒç½‘é¡µåµŒå…¥ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨æ–°çª—å£ä¸­æ‰“å¼€ã€‚</p>
        <button class="open-btn" onclick="window.open('https://www.threads.net/', '_blank')">
          ğŸš€ æ‰“å¼€ Threads
        </button>
      </div>
    </div>

    <!-- Bluesky (bsky-embed web componentï¼Œæ— éœ€è®¤è¯) -->
    <div class="platform-content" id="content-bluesky">
      <div class="quick-actions">
        <div class="quick-action" onclick="window.open('https://bsky.app/', '_blank')">ğŸ  é¦–é¡µ</div>
        <div class="quick-action" onclick="window.open('https://bsky.app/search', '_blank')">ğŸ” æœç´¢</div>
        <div class="quick-action" onclick="window.open('https://bsky.app/notifications', '_blank')">ğŸ”” é€šçŸ¥</div>
      </div>
      <div class="embed-container" style="overflow-y: auto; padding: 8px;">
        <script type="module" src="https://cdn.jsdelivr.net/npm/bsky-embed/dist/bsky-embed.es.js" async></script>
        <bsky-embed
          username="bsky.app"
          mode="dark"
          limit="15"
          link-target="_blank"
          load-more="true"
          custom-styles="* { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; } .border-slate-300 { border-color: rgba(0,240,255,0.2) !important; } a { color: #00f0ff !important; }"
        ></bsky-embed>
      </div>
    </div>

    <!-- Mastodon -->
    <div class="platform-content" id="content-mastodon">
      <div class="quick-actions">
        <div class="quick-action" onclick="window.open('https://mastodon.social/explore', '_blank')">ğŸŒ æ¢ç´¢</div>
        <div class="quick-action" onclick="window.open('https://joinmastodon.org/', '_blank')">â„¹ï¸ äº†è§£æ›´å¤š</div>
      </div>
      <div class="embed-container">
        <div class="loading-overlay" id="loading-mastodon">
          <div class="loading-spinner"></div>
        </div>
        <iframe src="https://mastodon.social/public/local" onload="hideLoading('mastodon')" onerror="showFallback('mastodon')"></iframe>
      </div>
    </div>

    <!-- Reddit -->
    <div class="platform-content" id="content-reddit">
      <div class="quick-actions">
        <div class="quick-action" onclick="window.open('https://www.reddit.com/', '_blank')">ğŸ  é¦–é¡µ</div>
        <div class="quick-action" onclick="window.open('https://www.reddit.com/r/popular/', '_blank')">ğŸ”¥ çƒ­é—¨</div>
        <div class="quick-action" onclick="window.open('https://www.reddit.com/r/all/', '_blank')">ğŸŒ å…¨éƒ¨</div>
      </div>
      <div class="fallback-ui">
        <div class="platform-icon">ğŸ¤–</div>
        <h3>Reddit</h3>
        <p>Reddit é™åˆ¶ iframe åµŒå…¥ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨æ–°çª—å£ä¸­æ‰“å¼€ã€‚</p>
        <button class="open-btn" onclick="window.open('https://www.reddit.com/', '_blank')">
          ğŸš€ æ‰“å¼€ Reddit
        </button>
      </div>
    </div>

    <!-- å¾®åš Weibo -->
    <div class="platform-content" id="content-weibo">
      <div class="quick-actions">
        <div class="quick-action" onclick="window.open('https://weibo.com/', '_blank')">ğŸ  é¦–é¡µ</div>
        <div class="quick-action" onclick="window.open('https://s.weibo.com/top/summary', '_blank')">ğŸ”¥ çƒ­æœ</div>
        <div class="quick-action" onclick="window.open('https://weibo.com/mygroups', '_blank')">ğŸ‘¥ åˆ†ç»„</div>
        <div class="quick-action" onclick="window.open('https://message.weibo.com/', '_blank')">âœ‰ï¸ ç§ä¿¡</div>
      </div>
      <div class="embed-container">
        <div class="loading-overlay" id="loading-weibo">
          <div class="loading-spinner"></div>
        </div>
        <iframe src="https://m.weibo.cn/p/index?containerid=102803" onload="hideLoading('weibo')" onerror="showWeiboFallback()"></iframe>
      </div>
    </div>
  </div>

  <!-- è½®æ’­æ§åˆ¶ -->
  <div class="carousel-controls">
    <div class="carousel-dot active" data-index="0" onclick="goToSlide(0)"></div>
    <div class="carousel-dot" data-index="1" onclick="goToSlide(1)"></div>
    <div class="carousel-dot" data-index="2" onclick="goToSlide(2)"></div>
    <div class="carousel-dot" data-index="3" onclick="goToSlide(3)"></div>
    <div class="carousel-dot" data-index="4" onclick="goToSlide(4)"></div>
    <div class="carousel-dot" data-index="5" onclick="goToSlide(5)"></div>
    <button class="carousel-toggle" id="carousel-toggle" onclick="toggleCarousel()">
      â–¶ è‡ªåŠ¨è½®æ’­
    </button>
  </div>

  <script>
    const platforms = ['x', 'threads', 'bluesky', 'mastodon', 'reddit', 'weibo'];
    let currentIndex = 0;
    let carouselInterval = null;
    let isCarouselPlaying = false;

    // åˆ‡æ¢å¹³å°
    function switchPlatform(platform) {
      const index = platforms.indexOf(platform);
      if (index === -1) return;

      currentIndex = index;

      // æ›´æ–°æ ‡ç­¾çŠ¶æ€
      document.querySelectorAll('.platform-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.platform === platform);
      });

      // æ›´æ–°å†…å®¹æ˜¾ç¤º
      document.querySelectorAll('.platform-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById('content-' + platform).classList.add('active');

      // æ›´æ–°è½®æ’­æŒ‡ç¤ºå™¨
      document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });

    }

    // Twitter fallbackï¼ˆiframe åŠ è½½å¤±è´¥æ—¶è°ƒç”¨ï¼‰
    function showTwitterFallback() {
      var container = document.getElementById('twitter-container');
      if (!container) return;

      container.innerHTML = '';

      var fallback = document.createElement('div');
      fallback.className = 'fallback-ui';

      var icon = document.createElement('div');
      icon.className = 'platform-icon';
      icon.textContent = '\u{1D54F}';
      fallback.appendChild(icon);

      var title = document.createElement('h3');
      title.textContent = 'X / Twitter';
      fallback.appendChild(title);

      var desc = document.createElement('p');
      desc.textContent = 'Twitter Timeline åŠ è½½å¤±è´¥ã€‚å¯èƒ½æ˜¯ç½‘ç»œé™åˆ¶ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨æ–°çª—å£ä¸­æ‰“å¼€ã€‚';
      fallback.appendChild(desc);

      var btn = document.createElement('button');
      btn.className = 'open-btn';
      btn.textContent = '\uD83D\uDE80 æ‰“å¼€ X';
      btn.addEventListener('click', function() {
        window.open('https://x.com/explore', '_blank');
      });
      fallback.appendChild(btn);

      container.appendChild(fallback);
    }

    function hideLoading(platform) {
      const loading = document.getElementById('loading-' + platform);
      if (loading) {
        setTimeout(() => loading.classList.add('hidden'), 300);
      }
    }

    function showFallback(platform) {
      hideLoading(platform);
      // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤š fallback é€»è¾‘
    }

    function showWeiboFallback() {
      hideLoading('weibo');
      const container = document.querySelector('#content-weibo .embed-container');
      if (container) {
        container.innerHTML = `
          <div class="fallback-ui">
            <div class="platform-icon">ğŸ”´</div>
            <h3>å¾®åš Weibo</h3>
            <p>å¾®åšåµŒå…¥åŠ è½½å¤±è´¥ã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åœ¨æ–°çª—å£ä¸­æ‰“å¼€ã€‚</p>
            <button class="open-btn" onclick="window.open('https://weibo.com/', '_blank')">
              ğŸš€ æ‰“å¼€å¾®åš
            </button>
          </div>
        `;
      }
    }

    // è½®æ’­æ§åˆ¶
    function goToSlide(index) {
      if (index >= 0 && index < platforms.length) {
        switchPlatform(platforms[index]);
      }
    }

    function toggleCarousel() {
      const btn = document.getElementById('carousel-toggle');

      if (isCarouselPlaying) {
        clearInterval(carouselInterval);
        carouselInterval = null;
        isCarouselPlaying = false;
        btn.textContent = 'â–¶ è‡ªåŠ¨è½®æ’­';
        btn.classList.remove('playing');
      } else {
        isCarouselPlaying = true;
        btn.textContent = 'â¸ æš‚åœ';
        btn.classList.add('playing');

        carouselInterval = setInterval(() => {
          currentIndex = (currentIndex + 1) % platforms.length;
          switchPlatform(platforms[currentIndex]);
        }, 10000); // æ¯10ç§’åˆ‡æ¢
      }
    }

    // ===== Twitter å¸å·åˆ‡æ¢ =====
    var twitterAccounts = [];
    var currentTwitterAccount = '';

    function switchTwitterAccount(username) {
      currentTwitterAccount = username;
      var iframe = document.getElementById('twitter-iframe');
      var loading = document.getElementById('loading-x');

      // æ˜¾ç¤º loading
      if (loading) loading.classList.remove('hidden');

      iframe.src = '/api/twitter/timeline/' + encodeURIComponent(username);

      // æ›´æ–° chip æ¿€æ´»çŠ¶æ€
      document.querySelectorAll('#twitter-accounts .account-chip').forEach(function(chip) {
        chip.classList.toggle('active', chip.dataset.account === username);
      });
    }

    function buildTwitterAccountBar(accounts) {
      var bar = document.getElementById('twitter-accounts');
      bar.innerHTML = '';

      accounts.forEach(function(account, i) {
        var chip = document.createElement('button');
        chip.className = 'account-chip' + (i === 0 ? ' active' : '');
        chip.dataset.account = account;
        chip.textContent = '@' + account;
        chip.addEventListener('click', function() {
          switchTwitterAccount(account);
        });
        bar.appendChild(chip);
      });

      // æœ«å°¾åŠ ä¸€ä¸ª"åœ¨ X æ‰“å¼€"æŒ‰é’®
      var openBtn = document.createElement('button');
      openBtn.className = 'account-chip';
      openBtn.textContent = 'â†— æ‰“å¼€ X';
      openBtn.style.marginLeft = 'auto';
      openBtn.addEventListener('click', function() {
        window.open('https://x.com/explore', '_blank');
      });
      bar.appendChild(openBtn);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // ä»é…ç½®åŠ è½½ Twitter å¸å·åˆ—è¡¨
      fetch('/api/config')
        .then(function(r) { return r.json(); })
        .then(function(config) {
          // Twitter å¸å·
          twitterAccounts = config.right_screen?.social?.twitter_accounts || ['X'];
          buildTwitterAccountBar(twitterAccounts);
          // åŠ è½½ç¬¬ä¸€ä¸ªå¸å·
          switchTwitterAccount(twitterAccounts[0]);

          // Bluesky å¸å·
          var bskyAccount = config.right_screen?.social?.bluesky_account;
          if (bskyAccount) {
            var bskyEmbed = document.querySelector('bsky-embed');
            if (bskyEmbed) bskyEmbed.setAttribute('username', bskyAccount);
          }
        })
        .catch(function() {
          // é…ç½®åŠ è½½å¤±è´¥ï¼Œç”¨é»˜è®¤
          twitterAccounts = ['X'];
          buildTwitterAccountBar(twitterAccounts);
          switchTwitterAccount('X');
        });

      // Twitter iframe è¶…æ—¶ä¿æŠ¤ï¼š10 ç§’åè‹¥ä»åœ¨ loadingï¼Œæ˜¾ç¤º fallback
      setTimeout(function() {
        var loading = document.getElementById('loading-x');
        if (loading && !loading.classList.contains('hidden')) {
          showTwitterFallback();
        }
      }, 10000);
    });

    // ç›‘å¬ iframe åŠ è½½é”™è¯¯ï¼ˆBluesky, Mastodon, Weibo ç­‰ï¼‰
    document.querySelectorAll('iframe').forEach(function(iframe) {
      iframe.addEventListener('error', function() {
        var platform = iframe.closest('.platform-content').id.replace('content-', '');
        showFallback(platform);
      });
    });
  </script>
</body>
</html>
