<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIRY-DESK - å³å± Â· æƒ…æŠ¥è§†çª—</title>
  <link rel="stylesheet" href="/static/css/theme.css">
  <style>
    .right-layout {
      height: calc(100vh - 32px);
      display: flex;
    }

    .four-column-layout {
      flex: 1;
      display: flex;
      gap: 1px;
      background: var(--border-color);
    }

    .column {
      display: flex;
      flex-direction: column;
      background: var(--bg-primary);
      min-width: 0;
    }

    .column:nth-child(1) { flex: 2.5; }  /* ç¤¾åª’ */
    .column:nth-child(2) { flex: 2.5; }  /* æ–°é—» */
    .column:nth-child(3) { flex: 2; }    /* è‚¡ç¥¨ */
    .column:nth-child(4) { flex: 3; }    /* å‘Šè­¦ */

    .column-header {
      height: 32px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      font-size: 11px;
      color: var(--neon-cyan);
      text-transform: uppercase;
      letter-spacing: 1px;
      flex-shrink: 0;
    }

    .column-header .col-title {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .column-header .col-actions {
      display: flex;
      gap: 4px;
    }

    .column-header .col-actions button {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 2px 4px;
      font-size: 12px;
    }

    .column-header .col-actions button:hover {
      color: var(--neon-cyan);
    }

    .column-body {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* ç¤¾åª’æ  - iframe */
    .social-frame {
      width: 100%;
      height: 100%;
      border: none;
      background: var(--bg-primary);
    }

    /* æ–°é—»æ  */
    .news-feed {
      height: 100%;
      overflow-y: auto;
    }

    /* è‚¡ç¥¨æ  */
    .stocks-container {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .stock-ticker {
      height: 32px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      overflow: hidden;
      display: flex;
      align-items: center;
    }

    .ticker-content {
      display: flex;
      animation: ticker 20s linear infinite;
      white-space: nowrap;
    }

    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .ticker-item {
      padding: 0 16px;
      font-size: 12px;
      font-family: var(--font-mono);
    }

    .ticker-item .symbol {
      color: var(--text-primary);
      margin-right: 8px;
    }

    .ticker-item .price {
      color: var(--neon-cyan);
    }

    .ticker-item .change.up {
      color: var(--status-success);
    }

    .ticker-item .change.down {
      color: var(--status-danger);
    }

    .stock-charts {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .stock-chart-item {
      margin-bottom: 12px;
      background: var(--bg-secondary);
      border-radius: 4px;
      overflow: hidden;
    }

    .stock-chart-item iframe {
      width: 100%;
      height: 150px;
      border: none;
    }

    /* å‘Šè­¦æ  */
    .alert-feed {
      height: 100%;
      overflow-y: auto;
    }

    /* HIDRS æç¤º */
    .hidrs-hint {
      margin: 12px;
      padding: 16px;
      background: var(--bg-tertiary);
      border: 1px dashed var(--border-color);
      border-radius: 4px;
      text-align: center;
    }

    .hidrs-hint .hint-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .hidrs-hint .hint-title {
      color: var(--neon-cyan);
      font-weight: bold;
      margin-bottom: 8px;
    }

    .hidrs-hint ul {
      text-align: left;
      padding-left: 20px;
      margin: 8px 0;
      color: var(--text-secondary);
      font-size: 12px;
    }

    .hidrs-hint li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body data-page="right">
  <div class="screen-container">
    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <div class="status-bar">
      <div class="title">
        ğŸ“Š æƒ…æŠ¥è§†çª—
      </div>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span id="hidrs-status" class="hidrs-status disconnected">ğŸ”´ HIDRS</span>
        <div class="clock" id="clock">--:--:--</div>
      </div>
    </div>

    <div class="right-layout">
      <div class="four-column-layout">
        <!-- ç¬¬1æ : ç¤¾äº¤åª’ä½“ -->
        <div class="column">
          <div class="column-header">
            <div class="col-title">
              <span>ğŸ“±</span>
              <span>SNS / ç¤¾äº¤</span>
            </div>
            <div class="col-actions">
              <button onclick="refreshSocial()" title="åˆ·æ–°">ğŸ”„</button>
              <button onclick="window.open('/widget/social', '_blank')" title="å¼¹å‡ºçª—å£">â›¶</button>
            </div>
          </div>
          <div class="column-body" id="social-container">
            <!-- ä½¿ç”¨å†…ç½®ç¤¾äº¤åª’ä½“å°ç»„ä»¶ï¼ˆæ”¯æŒ X/Threads/Bluesky/Mastodon/Reddit è½®æ’­ï¼‰ -->
            <iframe src="/widget/social" class="social-frame" id="social-frame"></iframe>
          </div>
        </div>

        <!-- ç¬¬2æ : æ–°é—» -->
        <div class="column">
          <div class="column-header">
            <div class="col-title">
              <span>ğŸ“°</span>
              <span>ãƒ‹ãƒ¥ãƒ¼ã‚¹ / æ–°é—»</span>
            </div>
            <div class="col-actions">
              <button onclick="loadNewsFeeds()" title="åˆ·æ–°">ğŸ”„</button>
            </div>
          </div>
          <div class="column-body">
            <div class="news-feed feed-list" id="news-feed">
              <div class="loading">
                <div class="loading-spinner"></div>
                <span>åŠ è½½ä¸­...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ç¬¬3æ : è‚¡ç¥¨è¡Œæƒ… -->
        <div class="column">
          <div class="column-header">
            <div class="col-title">
              <span>ğŸ“ˆ</span>
              <span>ãƒãƒ¼ã‚±ãƒƒãƒˆ / è¡Œæƒ…</span>
            </div>
            <div class="col-actions">
              <button onclick="location.href='/settings#stocks'" title="è®¾ç½®">âš™ï¸</button>
            </div>
          </div>
          <div class="column-body">
            <div class="stocks-container">
              <div class="stock-ticker">
                <div class="ticker-content" id="stock-ticker">
                  <!-- æ»šåŠ¨è¡Œæƒ…ç”± JS å¡«å…… -->
                </div>
              </div>
              <div class="stock-charts" id="stock-charts">
                <!-- TradingView widgets ç”± JS å¡«å…… -->
              </div>
            </div>
          </div>
        </div>

        <!-- ç¬¬4æ : å‘Šè­¦æ—¥å¿— -->
        <div class="column">
          <div class="column-header">
            <div class="col-title">
              <span>ğŸš¨</span>
              <span>ãƒ­ã‚° / å‘Šè­¦</span>
            </div>
            <div class="col-actions">
              <button onclick="clearAlerts()" title="æ¸…ç©º">ğŸ—‘ï¸</button>
            </div>
          </div>
          <div class="column-body">
            <div class="alert-feed feed-list" id="alert-feed">
              <!-- å‘Šè­¦ç”± JS å¡«å…… -->
            </div>

            <!-- HIDRS æœªè¿æ¥æç¤º -->
            <div class="hidrs-hint" id="hidrs-hint">
              <div class="hint-icon">ğŸ”®</div>
              <div class="hint-title">HIDRS æœªè¿æ¥</div>
              <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                å¼€å¯ HIDRS å¯è·å¾—æ›´å¤šå‘Šè­¦æ¥æºï¼š
              </p>
              <ul>
                <li>ç½‘ç»œæ‹“æ‰‘å¼‚å¸¸æ£€æµ‹</li>
                <li>Fiedler å€¼çªå˜å‘Šè­¦</li>
                <li>ç¤¾åŒºç»“æ„å˜åŒ–</li>
                <li>AI å†³ç­–åé¦ˆ</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/js/core.js"></script>
  <script>
    // å³å±ç‰¹å®šé€»è¾‘

    // åˆå§‹åŒ–è‚¡ç¥¨å›¾è¡¨
    function initStockCharts() {
      const symbols = FairyDesk.config?.right_screen?.stocks?.symbols || ['AAPL', 'BTCUSD'];
      const theme = FairyDesk.config?.right_screen?.stocks?.theme || 'dark';

      // æ»šåŠ¨è¡Œæƒ…æ¡
      const tickerEl = document.getElementById('stock-ticker');
      if (tickerEl) {
        const tickerHtml = symbols.map(s => `
          <div class="ticker-item">
            <span class="symbol">${s}</span>
            <span class="price">---</span>
            <span class="change">--%</span>
          </div>
        `).join('');
        tickerEl.innerHTML = tickerHtml + tickerHtml; // é‡å¤ä»¥å®ç°æ— ç¼æ»šåŠ¨
      }

      // TradingView Mini Chart Widgets
      const chartsEl = document.getElementById('stock-charts');
      if (chartsEl) {
        chartsEl.innerHTML = symbols.slice(0, 4).map(symbol => `
          <div class="stock-chart-item">
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
              {
                "symbol": "${symbol.includes(':') ? symbol : 'NASDAQ:' + symbol}",
                "width": "100%",
                "height": "150",
                "locale": "zh_CN",
                "dateRange": "1D",
                "colorTheme": "${theme}",
                "isTransparent": true,
                "autosize": true,
                "largeChartUrl": ""
              }
              <\/script>
            </div>
          </div>
        `).join('');
      }
    }

    // ç¤¾äº¤åª’ä½“ - åˆ·æ–°å†…ç½®å°ç»„ä»¶
    function refreshSocial() {
      const frame = document.getElementById('social-frame');
      if (frame) {
        frame.src = frame.src;
        showNotification('ç¤¾äº¤åª’ä½“å·²åˆ·æ–°', 'info');
      }
    }

    // æ¸…ç©ºå‘Šè­¦
    function clearAlerts() {
      if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰å‘Šè­¦ï¼Ÿ')) {
        document.getElementById('alert-feed').innerHTML = '';
        showNotification('å‘Šè­¦å·²æ¸…ç©º', 'success');
      }
    }

    // æ·»åŠ æ¨¡æ‹Ÿå‘Šè­¦ï¼ˆæ¼”ç¤ºç”¨ï¼‰
    function addDemoAlert() {
      const types = ['critical', 'warning', 'info'];
      const messages = [
        'æ£€æµ‹åˆ°ç½‘ç»œæµé‡å¼‚å¸¸',
        'ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 80%',
        'RSS æºæ›´æ–°å®Œæˆ',
        'æ–°çš„å®‰å…¨å…¬å‘Šå‘å¸ƒ',
        'æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡'
      ];

      const event = {
        type: types[Math.floor(Math.random() * types.length)],
        message: messages[Math.floor(Math.random() * messages.length)],
        timestamp: new Date().toISOString()
      };

      appendAlert(event, document.getElementById('alert-feed'), true);
    }

    // é¡µé¢åŠ è½½ååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // å»¶è¿ŸåŠ è½½è‚¡ç¥¨å›¾è¡¨ï¼ˆç­‰å¾…é…ç½®åŠ è½½å®Œæˆï¼‰
      setTimeout(initStockCharts, 1000);

      // æ¼”ç¤ºï¼šå®šæœŸæ·»åŠ æ¨¡æ‹Ÿå‘Šè­¦
      setInterval(addDemoAlert, 30000);
    });
  </script>
</body>
</html>
