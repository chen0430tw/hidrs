# HIDRSæ”»å‡»è®°å¿†ç³»ç»Ÿ

## æ¦‚è¿°

HIDRSæ”»å‡»è®°å¿†ç³»ç»Ÿæ˜¯ä¸€ä¸ªæ™ºèƒ½é˜²å¾¡ç³»ç»Ÿï¼Œç±»ä¼¼äººç±»å…ç–«ç³»ç»Ÿï¼Œèƒ½å¤Ÿè®°ä½æ”»å‡»æ¨¡å¼å¹¶ä¸æ–­å­¦ä¹ ã€‚å½“ç³»ç»Ÿç¬¬ä¸€æ¬¡é‡åˆ°æ”»å‡»æ—¶ï¼Œä¼šè®°å½•å…¶ç‰¹å¾ï¼›å†æ¬¡é‡åˆ°æ—¶ï¼Œèƒ½å¤Ÿç«‹å³è¯†åˆ«å¹¶å…ç–«ï¼›æ”»å‡»å˜å¼‚æ—¶ï¼Œä¼šæ›´æ–°è®°å¿†ã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. æ”»å‡»æ¨¡å¼è®°å¿†
- **æ¨¡å¼è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œå­¦ä¹ æ”»å‡»ç‰¹å¾
- **é¢‘ç‡è¿½è¸ª**ï¼šè®°å½•æ¯ç§æ”»å‡»æ¨¡å¼å‡ºç°çš„æ¬¡æ•°
- **æ—¶é—´åˆ†æ**ï¼šåˆ†ææ”»å‡»çš„æ—¶é—´åå¥½ï¼ˆ24å°æ—¶åˆ†å¸ƒï¼‰
- **æºè¿½è¸ª**ï¼šè¿½è¸ªä½¿ç”¨ç›¸åŒæ¨¡å¼çš„æ‰€æœ‰æ”»å‡»æº

### 2. æ”»å‡»è€…ç”»åƒ
- **è¡Œä¸ºåˆ†æ**ï¼šå»ºç«‹æ”»å‡»è€…çš„è¡Œä¸ºæ¨¡å‹
- **å¨èƒè¯„åˆ†**ï¼š0-100åˆ†çš„å¨èƒç­‰çº§è¯„ä¼°
- **å¤æ‚åº¦è¯„ä¼°**ï¼š1-5çº§çš„æ”»å‡»å¤æ‚åº¦
- **æŒç»­æ€§ç›‘æ§**ï¼šè¿½è¸ªæ”»å‡»è€…çš„æ´»è·ƒæ—¶é—´è·¨åº¦

### 3. æ™ºèƒ½é¢„æµ‹
- **ä¸‹ä¸€æ­¥æ”»å‡»é¢„æµ‹**ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹æ”»å‡»è€…çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- **ç›®æ ‡ç«¯å£é¢„æµ‹**ï¼šé¢„æµ‹å¯èƒ½è¢«æ”»å‡»çš„ç«¯å£
- **æ—¶é—´é¢„æµ‹**ï¼šé¢„æµ‹æ”»å‡»å¯èƒ½å‘ç”Ÿçš„æ—¶æ®µ

### 4. ä¸‰ç§è¿è¡Œæ¨¡å¼

#### æ­£å¼æ¨¡å¼ (Live Mode)
- å®Œæ•´çš„é˜²å¾¡åŠŸèƒ½
- å®é™…é˜»æ–­/Tarpitæ¶æ„æµé‡
- å®æ—¶å­¦ä¹ æ”»å‡»æ¨¡å¼
- é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ

#### æ¨¡æ‹Ÿæ¨¡å¼ (Simulation Mode)
- **åªè®°å½•æ—¥å¿—ï¼Œä¸å®é™…æ‰§è¡Œé˜²å¾¡åŠ¨ä½œ**
- å­¦ä¹ æ”»å‡»æ¨¡å¼ä½†ä¸é˜»æ–­
- ç”¨äºæµ‹è¯•é˜²ç«å¢™é…ç½®
- æŸ¥çœ‹é˜²ç«å¢™åœ¨å®é™…ç¯å¢ƒä¸­ä¼šåšä»€ä¹ˆ
- é€‚ç”¨äºï¼š
  - æ–°ç¯å¢ƒæµ‹è¯•
  - è§„åˆ™éªŒè¯
  - åŸ¹è®­æ¼”ç¤º

#### æµ‹è¯•æ¨¡å¼ (Test Mode)
- **å°èŒƒå›´å®é™…æµ‹è¯•**
- ä»…å¯¹ç™½åå•IPæ‰§è¡Œé˜²å¾¡
- é™åˆ¶æœ€å¤§å®¢æˆ·ç«¯æ•°
- ç”¨äºæ¸è¿›å¼éƒ¨ç½²
- é€‚ç”¨äºï¼š
  - åˆ†é˜¶æ®µä¸Šçº¿
  - A/Bæµ‹è¯•
  - é£é™©æ§åˆ¶

## æŠ€æœ¯æ¶æ„

### æ•°æ®ç»“æ„

#### AttackPatternï¼ˆæ”»å‡»æ¨¡å¼ï¼‰
```python
@dataclass
class AttackPattern:
    pattern_id: str              # æ¨¡å¼IDï¼ˆæ”»å‡»ç±»å‹_å“ˆå¸Œï¼‰
    attack_type: str             # æ”»å‡»ç±»å‹
    signatures: List[str]        # ç‰¹å¾ç­¾ååˆ—è¡¨
    first_seen: datetime         # é¦–æ¬¡å‡ºç°æ—¶é—´
    last_seen: datetime          # æœ€åå‡ºç°æ—¶é—´
    occurrence_count: int        # å‡ºç°æ¬¡æ•°
    source_ips: List[str]        # æ¥æºIPåˆ—è¡¨
    target_ports: List[int]      # ç›®æ ‡ç«¯å£åˆ—è¡¨
    success_rate: float          # æ”»å‡»æˆåŠŸç‡
    severity: int                # ä¸¥é‡æ€§ï¼ˆ1-10ï¼‰
    avg_packet_size: float       # å¹³å‡åŒ…å¤§å°
    avg_request_rate: float      # å¹³å‡è¯·æ±‚ç‡
    time_pattern: List[int]      # 24å°æ—¶æ—¶é—´åˆ†å¸ƒ
```

#### AttackerProfileï¼ˆæ”»å‡»è€…ç”»åƒï¼‰
```python
@dataclass
class AttackerProfile:
    ip: str                          # æ”»å‡»è€…IP
    first_attack: datetime           # é¦–æ¬¡æ”»å‡»æ—¶é—´
    last_attack: datetime            # æœ€åæ”»å‡»æ—¶é—´
    total_attacks: int               # æ€»æ”»å‡»æ¬¡æ•°
    attack_types: List[str]          # ä½¿ç”¨çš„æ”»å‡»ç±»å‹
    patterns_used: List[str]         # ä½¿ç”¨çš„æ¨¡å¼ID
    success_rate: float              # æˆåŠŸç‡
    threat_score: float              # å¨èƒåˆ†ï¼ˆ0-100ï¼‰
    preferred_ports: List[int]       # åå¥½ç«¯å£
    attack_time_preference: List[int] # æ”»å‡»æ—¶é—´åå¥½
    sophistication_level: int        # å¤æ‚åº¦ï¼ˆ1-5ï¼‰
```

### æ ¸å¿ƒç®—æ³•

#### 1. æ¨¡å¼è¯†åˆ«ç®—æ³•
```python
def recognize_attack(signatures: List[str]) -> Optional[AttackPattern]:
    """
    åŸºäºJaccardç›¸ä¼¼åº¦çš„æ¨¡å¼è¯†åˆ«

    ç›¸ä¼¼åº¦ = |A âˆ© B| / max(|A|, |B|)

    å½“ç›¸ä¼¼åº¦ > 0.5 æ—¶è®¤ä¸ºåŒ¹é…æˆåŠŸ
    """
```

#### 2. å¨èƒè¯„åˆ†ç®—æ³•
```python
def calculate_threat_score(profile: AttackerProfile) -> float:
    """
    å¨èƒåˆ† = æ”»å‡»é¢‘ç‡åˆ†(30) + æˆåŠŸç‡åˆ†(20) + å¤šæ ·æ€§åˆ†(10n)
           + å¤æ‚åº¦åˆ†(5n) + æŒç»­æ€§åˆ†(15)

    æœ€é«˜100åˆ†
    """
```

#### 3. æ¨¡å¼IDç”Ÿæˆ
```python
pattern_id = f"{attack_type}_{MD5(signatures)[:16]}"
```

## ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€ä½¿ç”¨

#### åˆå§‹åŒ–ï¼ˆæ­£å¼æ¨¡å¼ï¼‰
```python
from hidrs.defense.attack_memory import AttackMemorySystem

# æ­£å¼æ¨¡å¼
memory = AttackMemorySystem()
```

#### å­¦ä¹ æ”»å‡»æ¨¡å¼
```python
memory.learn_attack(
    src_ip='1.2.3.4',
    attack_type='sql_injection',
    signatures=['UNION SELECT', 'OR 1=1'],
    packet_size=512,
    success=False,
    port=80
)
```

#### è¯†åˆ«æ”»å‡»
```python
pattern = memory.recognize_attack(['UNION SELECT', 'OR 1=1'])
if pattern:
    print(f"è¯†åˆ«åˆ°å·²çŸ¥æ”»å‡»: {pattern.attack_type}")
    print(f"å‡ºç°è¿‡ {pattern.occurrence_count} æ¬¡")
```

#### æ£€æŸ¥å·²çŸ¥æ”»å‡»è€…
```python
is_known, profile = memory.is_known_attacker('1.2.3.4')
if is_known:
    print(f"å¨èƒåˆ†: {profile.threat_score:.1f}/100")
    print(f"å¤æ‚åº¦: {profile.sophistication_level}/5")
```

#### é¢„æµ‹ä¸‹ä¸€æ­¥æ”»å‡»
```python
prediction = memory.predict_next_attack('1.2.3.4')
if prediction:
    print(f"é¢„æµ‹ç±»å‹: {prediction['predicted_type']}")
    print(f"ç½®ä¿¡åº¦: {prediction['confidence']}%")
    print(f"å¯èƒ½ç«¯å£: {prediction['predicted_ports']}")
```

### 2. æ¨¡æ‹Ÿæ¨¡å¼ä½¿ç”¨

```python
# å¯ç”¨æ¨¡æ‹Ÿæ¨¡å¼
memory = AttackMemorySystem(simulation_mode=True)

# å­¦ä¹ æ”»å‡»ï¼ˆä¼šè®°å½•ä½†ä¸å®é™…é˜²å¾¡ï¼‰
memory.learn_attack(
    src_ip='5.6.7.8',
    attack_type='xss',
    signatures=['<script>', 'javascript:'],
    packet_size=256,
    success=False,
    port=443
)

# æ£€æŸ¥æ˜¯å¦åº”è¯¥é˜²å¾¡
should_defend, reason = memory.should_defend_against('5.6.7.8', 'xss')
print(f"æ˜¯å¦é˜²å¾¡: {should_defend}, åŸå› : {reason}")
# è¾“å‡º: æ˜¯å¦é˜²å¾¡: False, åŸå› : simulation_mode

# æŸ¥çœ‹æ¨¡æ‹Ÿæ—¥å¿—
sim_log = memory.get_simulation_log(limit=10)
print(f"æ¨¡æ‹Ÿæ—¥å¿—æ¡ç›®æ•°: {sim_log['total']}")
for log in sim_log['logs']:
    print(f"  {log['action']}: {log['timestamp']}")
```

### 3. æµ‹è¯•æ¨¡å¼ä½¿ç”¨

```python
# å¯ç”¨æµ‹è¯•æ¨¡å¼
memory = AttackMemorySystem(
    test_mode=True,
    test_whitelist_ips=['192.168.1.0/24', '10.0.0.1'],
    max_test_clients=5
)

# ç™½åå•IP - ä¼šé˜²å¾¡
should_defend, reason = memory.should_defend_against('192.168.1.100', 'port_scan')
print(f"ç™½åå•IP: {should_defend}, åŸå› : {reason}")
# è¾“å‡º: True, test_mode_allowed

# éç™½åå•IP - ä¸ä¼šé˜²å¾¡
should_defend, reason = memory.should_defend_against('8.8.8.8', 'port_scan')
print(f"éç™½åå•IP: {should_defend}, åŸå› : {reason}")
# è¾“å‡º: False, not_whitelisted
```

### 4. ä¸HIDRSFirewallé›†æˆ

#### æ­£å¼æ¨¡å¼
```python
from hidrs.defense.inverse_gfw import HIDRSFirewall

firewall = HIDRSFirewall(
    enable_attack_memory=True,
    simulation_mode=False,  # æ­£å¼æ¨¡å¼
    test_mode=False
)

firewall.start()

# å¤„ç†æ•°æ®åŒ…ï¼ˆä¼šè‡ªåŠ¨å­¦ä¹ å’Œè¯†åˆ«æ”»å‡»ï¼‰
result = firewall.process_packet(
    packet_data=b"GET /?id=1' OR 1=1-- HTTP/1.1\r\n",
    src_ip='5.6.7.8',
    src_port=54321,
    dst_ip='10.0.0.1',
    dst_port=80
)

print(f"åŠ¨ä½œ: {result['action']}")
print(f"é˜²å¾¡æ¨¡å¼: {result['defense_mode']}")
```

#### æ¨¡æ‹Ÿæ¨¡å¼
```python
firewall = HIDRSFirewall(
    enable_attack_memory=True,
    simulation_mode=True  # åªè®°å½•ï¼Œä¸å®é™…é˜²å¾¡
)

firewall.start()

result = firewall.process_packet(...)
# ä¼šå­¦ä¹ æ”»å‡»æ¨¡å¼ï¼Œä½†ä¸ä¼šå®é™…é˜»æ–­
print(f"åŠ¨ä½œ: {result['action']}")  # å¯èƒ½ä»æ˜¾ç¤º'block'
print(f"é˜²å¾¡æ¨¡å¼: {result['defense_mode']}")  # 'simulation_mode'

# æŸ¥çœ‹æ¨¡æ‹Ÿæ—¥å¿—
sim_log = firewall.get_simulation_log(limit=10)
```

#### æµ‹è¯•æ¨¡å¼
```python
firewall = HIDRSFirewall(
    enable_attack_memory=True,
    test_mode=True,
    test_whitelist_ips=['192.168.1.0/24', '10.0.0.1'],
    max_test_clients=5
)

firewall.start()

# ç™½åå•IPä¼šè¢«å®é™…é˜²å¾¡
result = firewall.process_packet(
    packet_data=b"malicious data",
    src_ip='192.168.1.100',  # ç™½åå•IP
    ...
)
# ä¼šå®é™…é˜»æ–­

# éç™½åå•IPä¸ä¼šè¢«é˜²å¾¡
result = firewall.process_packet(
    packet_data=b"malicious data",
    src_ip='1.2.3.4',  # éç™½åå•IP
    ...
)
# ä¸ä¼šé˜»æ–­ï¼Œåªè®°å½•
```

## APIå‚è€ƒ

### AttackMemorySystem

#### æ„é€ å‡½æ•°
```python
def __init__(
    memory_file: str = '/tmp/hidrs_attack_memory.pkl',
    simulation_mode: bool = False,
    test_mode: bool = False,
    test_whitelist_ips: List[str] = None,
    max_test_clients: int = 10
)
```

#### ä¸»è¦æ–¹æ³•

##### learn_attack()
å­¦ä¹ æ”»å‡»æ¨¡å¼
```python
def learn_attack(
    src_ip: str,
    attack_type: str,
    signatures: List[str],
    packet_size: int,
    success: bool,
    port: int
) -> None
```

##### recognize_attack()
è¯†åˆ«æ”»å‡»æ¨¡å¼
```python
def recognize_attack(
    signatures: List[str]
) -> Optional[AttackPattern]
```

##### is_known_attacker()
æ£€æŸ¥æ˜¯å¦ä¸ºå·²çŸ¥æ”»å‡»è€…
```python
def is_known_attacker(
    ip: str
) -> Tuple[bool, Optional[AttackerProfile]]
```

##### predict_next_attack()
é¢„æµ‹ä¸‹ä¸€æ­¥æ”»å‡»
```python
def predict_next_attack(
    ip: str
) -> Optional[Dict[str, Any]]
```

##### should_defend_against()
åˆ¤æ–­æ˜¯å¦åº”è¯¥é˜²å¾¡ï¼ˆæ ¹æ®æ¨¡å¼ï¼‰
```python
def should_defend_against(
    ip: str,
    attack_type: str
) -> Tuple[bool, str]
```

##### get_top_threats()
è·å–å¨èƒæœ€é«˜çš„æ”»å‡»è€…
```python
def get_top_threats(
    limit: int = 10
) -> List[AttackerProfile]
```

##### get_simulation_log()
è·å–æ¨¡æ‹Ÿæ—¥å¿—ï¼ˆä»…æ¨¡æ‹Ÿæ¨¡å¼ï¼‰
```python
def get_simulation_log(
    limit: int = 100
) -> Dict
```

##### save_memory()
ä¿å­˜è®°å¿†åˆ°æ–‡ä»¶
```python
def save_memory() -> None
```

##### cleanup_old_memories()
æ¸…ç†æ—§è®°å¿†
```python
def cleanup_old_memories(
    days: int = 30
) -> None
```

### HIDRSFirewallï¼ˆæ›´æ–°åï¼‰

#### æ–°å¢æ„é€ å‚æ•°
```python
def __init__(
    ...,
    enable_attack_memory: bool = True,
    simulation_mode: bool = False,
    test_mode: bool = False,
    test_whitelist_ips: List[str] = None,
    max_test_clients: int = 10
)
```

#### æ–°å¢æ–¹æ³•

##### get_top_threats()
```python
def get_top_threats(limit: int = 10) -> List[Dict]
```

##### predict_next_attack()
```python
def predict_next_attack(ip: str) -> Optional[Dict]
```

##### get_simulation_log()
```python
def get_simulation_log(limit: int = 100) -> Dict
```

##### get_memory_stats()
```python
def get_memory_stats() -> Dict
```

## ç»Ÿè®¡ä¿¡æ¯

### æ”»å‡»è®°å¿†ç»Ÿè®¡
```python
stats = memory.get_stats()
# è¿”å›:
{
    'mode': 'live|simulation|test',
    'simulation_mode': bool,
    'test_mode': bool,
    'test_whitelist_count': int,
    'max_test_clients': int,
    'total_patterns': int,
    'total_attackers': int,
    'total_attacks_remembered': int,
    'attack_type_distribution': dict,
    'average_threat_score': float,
    'simulation_log_count': int
}
```

### é˜²ç«å¢™ç»Ÿè®¡ï¼ˆå«è®°å¿†ï¼‰
```python
stats = firewall.get_stats()
# è¿”å›:
{
    'total_packets': int,
    'blocked_packets': int,
    'suspicious_packets': int,
    'tarpitted_connections': int,
    'reflected_attacks': int,
    'active_probes': int,
    'memory_recognitions': int,  # è®°å¿†è¯†åˆ«æ¬¡æ•°
    'active_connections': int,
    'blacklisted_ips': int,
    'whitelisted_ips': int,
    'attack_memory': {
        # æ”»å‡»è®°å¿†ç»Ÿè®¡ï¼ˆåµŒå¥—ï¼‰
        ...
    }
}
```

## éƒ¨ç½²å»ºè®®

### 1. æ¸è¿›å¼éƒ¨ç½²

#### é˜¶æ®µ1: è§‚å¯Ÿæ¨¡å¼ï¼ˆ1-2å‘¨ï¼‰
```python
# ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼Œåªè§‚å¯Ÿä¸é˜²å¾¡
firewall = HIDRSFirewall(
    simulation_mode=True,
    enable_attack_memory=True
)
```
- æ”¶é›†çœŸå®æµé‡æ•°æ®
- è§‚å¯Ÿé˜²ç«å¢™ä¼šå¦‚ä½•å“åº”
- è°ƒæ•´è§„åˆ™ä»¥å‡å°‘è¯¯æŠ¥

#### é˜¶æ®µ2: å°èŒƒå›´æµ‹è¯•ï¼ˆ1-2å‘¨ï¼‰
```python
# å¯¹å°‘æ•°IPè¿›è¡Œå®é™…é˜²å¾¡
firewall = HIDRSFirewall(
    test_mode=True,
    test_whitelist_ips=['å†…éƒ¨æµ‹è¯•IPæ®µ'],
    max_test_clients=10
)
```
- åœ¨å¯æ§èŒƒå›´å†…æµ‹è¯•é˜²å¾¡æ•ˆæœ
- éªŒè¯ä¸ä¼šå½±å“æ­£å¸¸ä¸šåŠ¡
- æ”¶é›†æ€§èƒ½æŒ‡æ ‡

#### é˜¶æ®µ3: å…¨é¢éƒ¨ç½²
```python
# å¯ç”¨å®Œæ•´é˜²å¾¡
firewall = HIDRSFirewall(
    simulation_mode=False,
    test_mode=False,
    enable_attack_memory=True
)
```
- ç›‘æ§ç³»ç»Ÿæ€§èƒ½
- å®šæœŸå®¡æŸ¥å¨èƒæŠ¥å‘Š
- è°ƒæ•´é˜²å¾¡ç­–ç•¥

### 2. é…ç½®å»ºè®®

#### ç”Ÿäº§ç¯å¢ƒ
```python
firewall = HIDRSFirewall(
    enable_active_probing=True,
    enable_hlig_detection=True,
    enable_syn_cookies=True,
    enable_tarpit=True,
    enable_traffic_reflection=False,  # è°¨æ…å¯ç”¨
    enable_attack_memory=True,
    simulation_mode=False,
    test_mode=False
)
```

#### æµ‹è¯•ç¯å¢ƒ
```python
firewall = HIDRSFirewall(
    enable_active_probing=True,
    enable_hlig_detection=True,
    enable_attack_memory=True,
    simulation_mode=True  # å®‰å…¨çš„æµ‹è¯•æ–¹å¼
)
```

#### åˆ†é˜¶æ®µä¸Šçº¿
```python
firewall = HIDRSFirewall(
    enable_attack_memory=True,
    test_mode=True,
    test_whitelist_ips=[
        '192.168.1.0/24',  # å†…ç½‘æ®µ
        '10.0.0.0/8'       # ç‰¹å®šä¸šåŠ¡
    ],
    max_test_clients=50
)
```

## æ€§èƒ½ä¼˜åŒ–

### 1. è®°å¿†æ¸…ç†
- é»˜è®¤æ¯å°æ—¶æ¸…ç†ä¸€æ¬¡æ—§è®°å¿†
- ä¿ç•™30å¤©å†…çš„æ”»å‡»è®°å½•
- é«˜å¨èƒæ”»å‡»è€…æ°¸ä¹…ä¿ç•™

### 2. æ¨¡å¼åŒ¹é…ä¼˜åŒ–
- ä½¿ç”¨MD5å“ˆå¸ŒåŠ é€Ÿæ¨¡å¼æŸ¥æ‰¾
- Jaccardç›¸ä¼¼åº¦é˜ˆå€¼: 0.5
- æœ€å¤šåŒ¹é…å‰100ä¸ªæ¨¡å¼

### 3. æŒä¹…åŒ–ç­–ç•¥
- ä½¿ç”¨pickleåºåˆ—åŒ–
- åœæœºæ—¶è‡ªåŠ¨ä¿å­˜
- æ¯å°æ—¶è‡ªåŠ¨å¤‡ä»½

## å®‰å…¨è€ƒè™‘

### 1. æ¨¡æ‹Ÿæ¨¡å¼å®‰å…¨æ€§
- **ä¸ä¼šæ‰§è¡Œä»»ä½•é˜²å¾¡åŠ¨ä½œ**
- æ‰€æœ‰"é˜»æ–­"éƒ½åªæ˜¯æ—¥å¿—è®°å½•
- é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æµ‹è¯•æ–°è§„åˆ™
- æ— é£é™©è§‚å¯Ÿé˜²ç«å¢™è¡Œä¸º

### 2. æµ‹è¯•æ¨¡å¼å®‰å…¨æ€§
- åªå¯¹ç™½åå•IPæ‰§è¡Œé˜²å¾¡
- é™åˆ¶æœ€å¤§å®¢æˆ·ç«¯æ•°é˜²æ­¢æ„å¤–æ‰©æ•£
- æ”¯æŒCIDRèŒƒå›´
- éç™½åå•IPå®Œå…¨ä¸å—å½±å“

### 3. éšç§ä¿æŠ¤
- IPåœ°å€ä»…ç”¨äºé˜²å¾¡ç›®çš„
- è®°å¿†æ–‡ä»¶æƒé™: 600 (ä»…æ‰€æœ‰è€…å¯è¯»å†™)
- å®šæœŸæ¸…ç†æ—§æ•°æ®
- ä¸è®°å½•ä¸šåŠ¡æ•°æ®å†…å®¹

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: è®°å¿†æœªç”Ÿæ•ˆ
```bash
# æ£€æŸ¥è®°å¿†æ–‡ä»¶
ls -la /tmp/hidrs_attack_memory.pkl

# æ£€æŸ¥ç»Ÿè®¡
stats = memory.get_stats()
print(stats['total_patterns'])  # åº”è¯¥ > 0
```

### é—®é¢˜2: æ¨¡æ‹Ÿæ¨¡å¼ä»åœ¨é˜»æ–­
```python
# ç¡®è®¤æ¨¡å¼
stats = firewall.get_stats()
print(stats['attack_memory']['mode'])  # åº”è¯¥æ˜¯ 'simulation'

# æ£€æŸ¥defense_mode
result = firewall.process_packet(...)
print(result['defense_mode'])  # åº”è¯¥æ˜¯ 'simulation_mode'
```

### é—®é¢˜3: æµ‹è¯•æ¨¡å¼æœªç”Ÿæ•ˆ
```python
# éªŒè¯IPåœ¨ç™½åå•ä¸­
from hidrs.defense.attack_memory import AttackMemorySystem
memory = AttackMemorySystem(
    test_mode=True,
    test_whitelist_ips=['192.168.1.0/24']
)
print(memory._is_ip_whitelisted('192.168.1.100'))  # åº”è¯¥æ˜¯ True
```

## æœ€ä½³å®è·µ

### 1. æ—¥å¿—ç›‘æ§
```python
import logging
logging.basicConfig(level=logging.INFO)

# å…³é”®æ—¥å¿—æ ‡è¯†:
# ğŸ§  - è®°å¿†ç³»ç»Ÿå­¦ä¹ 
# ğŸ¬ - æ¨¡æ‹Ÿæ¨¡å¼åŠ¨ä½œ
# ğŸ§ª - æµ‹è¯•æ¨¡å¼åŠ¨ä½œ
# ğŸ›¡ï¸ - æ­£å¼æ¨¡å¼é˜²å¾¡
```

### 2. å®šæœŸå®¡æŸ¥
```python
# æ¯æ—¥å®¡æŸ¥Topå¨èƒ
top_threats = firewall.get_top_threats(limit=20)
for threat in top_threats:
    if threat['threat_score'] > 80:
        # è€ƒè™‘åŠ å…¥æ°¸ä¹…é»‘åå•
        pass
```

### 3. å†…å­˜ç®¡ç†
```python
# å®šæœŸæ¸…ç†æ—§è®°å¿†ï¼ˆé‡Šæ”¾å†…å­˜ï¼‰
memory.cleanup_old_memories(days=30)

# æ‰‹åŠ¨ä¿å­˜
memory.save_memory()
```

### 4. æ¨¡å¼æ¼”åŒ–è¿½è¸ª
```python
# è¿½è¸ªæ”»å‡»æ¨¡å¼æ¼”åŒ–
patterns = memory.get_pattern_evolution('sql_injection')
for pattern in patterns:
    print(f"{pattern.first_seen}: {pattern.signatures}")
```

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯1: æ–°ç³»ç»Ÿä¸Šçº¿
1. **ç¬¬1å‘¨**ï¼šæ¨¡æ‹Ÿæ¨¡å¼ï¼Œæ”¶é›†æ•°æ®
2. **ç¬¬2å‘¨**ï¼šåˆ†ææ—¥å¿—ï¼Œè°ƒæ•´è§„åˆ™
3. **ç¬¬3å‘¨**ï¼šæµ‹è¯•æ¨¡å¼ï¼Œ10ä¸ªå†…éƒ¨IP
4. **ç¬¬4å‘¨**ï¼šå…¨é¢ä¸Šçº¿

### åœºæ™¯2: å·²æœ‰ç³»ç»Ÿå¢å¼º
1. å¯ç”¨æ”»å‡»è®°å¿†ï¼ˆæ­£å¼æ¨¡å¼ï¼‰
2. è§‚å¯Ÿ1å‘¨ï¼Œå­¦ä¹ æ­£å¸¸æµé‡
3. å®¡æŸ¥Topå¨èƒ
4. è°ƒæ•´HLIGæ£€æµ‹é˜ˆå€¼

### åœºæ™¯3: ç´§æ€¥å“åº”
1. æ£€æµ‹åˆ°æ–°å‹æ”»å‡»
2. ç³»ç»Ÿè‡ªåŠ¨å­¦ä¹ å¹¶è®°å¿†
3. ç¬¬äºŒæ¬¡æ”»å‡»ç«‹å³è¯†åˆ«
4. è‡ªåŠ¨é˜»æ–­ï¼Œæ— éœ€äººå·¥å¹²é¢„

## æ€»ç»“

HIDRSæ”»å‡»è®°å¿†ç³»ç»Ÿæä¾›äº†ç±»ä¼¼å…ç–«ç³»ç»Ÿçš„æ™ºèƒ½é˜²å¾¡èƒ½åŠ›ï¼š

âœ… **è‡ªåŠ¨å­¦ä¹ ** - æ— éœ€æ‰‹åŠ¨é…ç½®è§„åˆ™
âœ… **å¿«é€Ÿè¯†åˆ«** - å·²çŸ¥æ”»å‡»ç«‹å³å“åº”
âœ… **æ™ºèƒ½é¢„æµ‹** - æå‰é¢„è­¦æ½œåœ¨å¨èƒ
âœ… **å®‰å…¨æµ‹è¯•** - æ¨¡æ‹Ÿ/æµ‹è¯•æ¨¡å¼ä¿è¯å®‰å…¨éƒ¨ç½²
âœ… **æŒç»­è¿›åŒ–** - éšç€æ”»å‡»å˜åŒ–è€Œæ›´æ–°

é€šè¿‡åˆç†ä½¿ç”¨ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼Œå¯ä»¥å®ç°é›¶é£é™©çš„é˜²ç«å¢™å‡çº§å’Œéƒ¨ç½²ã€‚
